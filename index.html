<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin'Quest - Pr√©parateur intelligent aux oraux d'administrateur territorial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f8f9fa;
        }
        
        /* STYLES POUR L'√âCRAN DE V√âRIFICATION D'ABONNEMENT */
        .subscription-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .subscription-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .subscription-container h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subscription-container .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .subscription-form {
            margin-bottom: 30px;
        }
        
        .subscription-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            transition: border-color 0.3s;
        }
        
        .subscription-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .subscription-form button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .subscription-form button:hover {
            transform: translateY(-2px);
        }
        
        .subscription-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .price-tag {
            font-size: 2.5em;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        
        .features-list {
            text-align: left;
            margin: 20px 0;
        }
        
        .features-list li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .features-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #43a047;
            font-weight: bold;
        }
        
        .payment-section {
            border-top: 2px solid #ecf0f1;
            padding-top: 20px;
        }
        
        .payment-methods {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .payment-button {
            padding: 12px 25px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .payment-button:hover {
            background: #3498db;
            color: white;
        }
        
        .error-message {
            background: #ffebee;
            border: 1px solid #e74c3c;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .success-message {
            background: #e8f5e9;
            border: 1px solid #43a047;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .contact-info {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 20px;
        }
        
        /* STYLES POUR L'APPLICATION PRINCIPALE (cach√©e par d√©faut) */
        .main-app {
            display: none;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 20px;
        }
        
        .controls {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .controls div {
            margin-right: 20px;
        }
        
        select, input {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #bdc3c7;
            width: 200px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .question-container {
            margin-bottom: 15px;
            padding: 15px;
            border-left: 4px solid #3498db;
            background-color: #fff;
            transition: background-color 0.3s;
            border-radius: 5px;
        }
        
        .question-container:hover {
            background-color: #f8f9fa;
        }
        
        .question {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metadata {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .attention-points {
            margin-top: 10px;
            font-style: italic;
        }
        
        .keywords {
            margin-top: 5px;
        }
        
        .keyword {
            background-color: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 5px;
            display: inline-block;
        }
        
        .hidden {
            display: none;
        }
        
        #searchResults {
            margin-top: 20px;
        }
        
        #questionsCount {
            margin-top: 10px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .buttons-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn-import {
            background-color: #6c757d;
        }
        
        .btn-reset {
            background-color: #6c757d;
        }
        
        .difficulty-1 {
            border-left-color: #2ecc71; /* Vert */
        }
        
        .difficulty-2 {
            border-left-color: #3498db; /* Bleu */
        }
        
        .difficulty-3 {
            border-left-color: #f39c12; /* Orange */
        }
        
        .difficulty-4 {
            border-left-color: #e74c3c; /* Rouge */
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: #7f8c8d;
            font-size: 0.9em;
            border-top: 1px solid #ecf0f1;
        }

        .auto-response {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 60px;
        }

        .auto-response h4 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        .auto-response .response-icon {
            position: absolute;
            left: 15px;
            top: 15px;
            font-size: 28px;
        }

        .auto-response p {
            margin: 8px 0;
            line-height: 1.5;
        }

        .auto-response p strong {
            display: inline-block;
            min-width: 160px;
        }

        .auto-response.rafale {
            background-color: #e8f5e9;
            border-left: 5px solid #43a047;
        }
        .auto-response.rafale h4 {
            color: #2e7d32;
        }
        .auto-response.rafale .response-icon {
            color: #2e7d32;
        }

        .auto-response.enjeux {
            background-color: #e3f2fd;
            border-left: 5px solid #1976d2;
        }
        .auto-response.enjeux h4 {
            color: #0d47a1;
        }
        .auto-response.enjeux .response-icon {
            color: #0d47a1;
        }

        .auto-response.poisson {
            background-color: #fff8e1;
            border-left: 5px solid #ffa000;
        }
        .auto-response.poisson h4 {
            color: #e65100;
        }
        .auto-response.poisson .response-icon {
            color: #e65100;
        }

        .auto-response.reflexive {
            background-color: #f3e5f5;
            border-left: 5px solid #8e24aa;
        }
        .auto-response.reflexive h4 {
            color: #4a148c;
        }
        .auto-response.reflexive .response-icon {
            color: #4a148c;
        }

        .auto-response.theatre {
            background-color: #ffebee;
            border-left: 5px solid #e53935;
        }
        .auto-response.theatre h4 {
            color: #b71c1c;
        }
        .auto-response.theatre .response-icon {
            color: #b71c1c;
        }

        .auto-response.technique-longue {
            background-color: #fff3e0;
            border-left: 5px solid #ff6600;
        }
        .auto-response.technique-longue h4 {
            color: #e65100;
        }
        .auto-response.technique-longue .response-icon {
            color: #e65100;
        }

        .auto-response.technique-courte {
            background-color: #f1f8e9;
            border-left: 5px solid #8bc34a;
        }
        .auto-response.technique-courte h4 {
            color: #33691e;
        }
        .auto-response.technique-courte .response-icon {
            color: #33691e;
        }

        .methods-showcase {
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }
        
        .methods-showcase h3 {
            text-align: center;
            margin: 0 0 25px 0;
            color: #2c3e50;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .methods-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }
        
        .method-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            text-decoration: none;
            display: block;
            position: relative;
            overflow: hidden;
        }
        
        .method-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .method-card:hover::before {
            left: 100%;
        }
        
        .method-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 20px rgba(0,0,0,0.25);
        }
        
        .method-card i {
            font-size: 2.5em;
            margin-bottom: 12px;
            display: block;
        }
        
        .method-card .method-name {
            font-weight: bold;
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
        }
        
        .method-card .method-description {
            opacity: 0.9;
            font-size: 0.85em;
            line-height: 1.3;
        }

        .method-card.rafale { 
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%); 
        }
        .method-card.enjeux { 
            background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%); 
        }
        .method-card.poisson { 
            background: linear-gradient(135deg, #ffa000 0%, #e65100 100%); 
        }
        .method-card.reflexive { 
            background: linear-gradient(135deg, #8e24aa 0%, #4a148c 100%); 
        }
        .method-card.theatre { 
            background: linear-gradient(135deg, #e53935 0%, #b71c1c 100%); 
        }
        .method-card.technique-longue { 
            background: linear-gradient(135deg, #ff6600 0%, #e65100 100%); 
        }
        .method-card.technique-courte { 
            background: linear-gradient(135deg, #8bc34a 0%, #33691e 100%); 
        }

        .method-card.disabled-link {
            cursor: default;
        }
        
        .method-card.disabled-link:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .response-controls {
            background-color: #fff;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .response-controls label {
            margin-right: 10px;
        }

        .header-container {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            height: 400px;
            margin-right: 15px;
        }
        
        .subtitle {
            color: #3498db;
            margin: 15px 0;
            font-size: 1.5em;
            font-weight: normal;
        }

        .author {
            font-size: 1em;
            color: #7f8c8d;
            margin-top: 10px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .exam-toggle-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .toggle-label {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-label input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3498db;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #e74c3c;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .toggle-labels {
            display: flex;
            gap: 20px;
        }

        .toggle-labels span {
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .toggle-labels span.active {
            opacity: 1;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        .tabs-container {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tabs {
            display: flex;
            background-color: #fff;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
        }

        .tab {
            color: #2c3e50;
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-bottom: none;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            font-weight: 500;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab[data-epreuve="all"]::before {
            content: "üéì";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="ENTRETIEN"]::before {
            content: "üë®‚Äçüíº";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="DGCT"]::before {
            content: "üèõÔ∏è";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="QE"]::before {
            content: "‚≠ê";
            font-size: 1.5em;
            color: #1E90FF;
        }
        
        .tab[data-epreuve="QS"]::before {
            content: "ü§ù";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="ANGLAIS"]::before {
            content: "üí¨";
            font-size: 1.5em;
            color: #DC143C;
        }

        .tab[data-epreuve="all"] {
            background-color: #ecf0f1;
        }
        
        .tab[data-epreuve="ENTRETIEN"] {
            background-color: #bbdefb;
        }
        
        .tab[data-epreuve="DGCT"] {
            background-color: #c8e6c9;
        }
        
        .tab[data-epreuve="QE"] {
            background-color: #ffe0b2;
        }
        
        .tab[data-epreuve="QS"] {
            background-color: #e1bee7;
        }
        
        .tab[data-epreuve="ANGLAIS"] {
            background-color: #ffcdd2;
        }

        .tab:hover {
            filter: brightness(0.9);
        }

        .tab.active {
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid #333;
        }

        .tab.active[data-epreuve="all"] {
            background-color: #7f8c8d;
        }
        
        .tab.active[data-epreuve="ENTRETIEN"] {
            background-color: #1976d2;
        }
        
        .tab.active[data-epreuve="DGCT"] {
            background-color: #388e3c;
        }
        
        .tab.active[data-epreuve="QE"] {
            background-color: #f57c00;
        }
        
        .tab.active[data-epreuve="QS"] {
            background-color: #7b1fa2;
        }
        
        .tab.active[data-epreuve="ANGLAIS"] {
            background-color: #c62828;
        }

        .tab.active::after {
            content: "üëë";
            font-size: 1.2em;
            margin-left: 8px;
        }

        .tab-badge {
            background-color: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .tab.disabled {
            background-color: #bdc3c7 !important;
            color: #7f8c8d !important;
            opacity: 0.5;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        .tab.disabled:hover {
            background-color: #bdc3c7 !important;
            transform: none !important;
            filter: none !important;
        }

        .tab.disabled .tab-badge {
            background-color: rgba(0,0,0,0.2) !important;
        }

        .tab.active[data-epreuve="QE"]::before {
            color: #fff;
        }
        
        .tab.active[data-epreuve="ANGLAIS"]::before {
            color: #fff;
        }

        /* Bouton de d√©connexion dans l'app */
        .logout-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .subscription-container {
                padding: 20px;
                margin: 10px;
            }
            
            .price-tag {
                font-size: 2em;
            }
            
            .payment-methods {
                flex-direction: column;
                align-items: center;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .methods-cards {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .method-card {
                padding: 20px 10px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9em;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- √âCRAN DE V√âRIFICATION D'ABONNEMENT -->
    <div id="subscriptionOverlay" class="subscription-overlay">
        <div class="subscription-container">
            <h2>üéì Admin'Quest</h2>
            <p class="subtitle">Pr√©parateur intelligent aux oraux d'administrateur territorial</p>
            
            <div id="subscriptionForm" class="subscription-form">
                <h3>Acc√®s par code d'abonnement</h3>
                <input type="text" id="subscriptionCode" placeholder="Entrez votre code d'acc√®s" maxlength="20">
                <button onclick="validateSubscription()">Valider l'acc√®s</button>
                <div id="subscriptionError" class="error-message" style="display: none;"></div>
                <div id="subscriptionSuccess" class="success-message" style="display: none;"></div>
            </div>
            
            <div class="subscription-info">
                <h3>Abonnement Annuel</h3>
                <div class="price-tag">97‚Ç¨</div>
                <ul class="features-list">
                    <li>üóÉÔ∏è Base de donn√©es de 700+ questions d'oraux</li>
                    <li>üéØ 7 m√©thodes de r√©ponse structur√©es</li>
                    <li>üìä Filtrage par √©preuve, difficult√© et cat√©gorie</li>
                    <li>üé™ Mode examen professionnel</li>
                    <li>üí° R√©ponses automatiques d√©taill√©es</li>
                    <li>üì± Interface responsive</li>
                    <li>üîÑ Mises √† jour r√©guli√®res</li>
                </ul>
            </div>
            
            <div class="payment-section">
                <h4>üí≥ Commandez votre abonnement :</h4>
                <div class="payment-methods">
                    <a href="mailto:fabrice.ribet@gmail.com?subject=Commande Admin'Quest&body=Je souhaite commander un abonnement annuel Admin'Quest pour 97‚Ç¨. Merci de me faire parvenir les instructions de paiement." class="payment-button">
                        üìß Commander par email
                    </a>
                    <a href="https://www.paypal.com/paypalme/fabriceribet?amount=97" target="_blank" class="payment-button">
                        üí∞ PayPal (97‚Ç¨)
                    </a>
                </div>
                <div class="contact-info">
                    <p><strong>üìû Contact :</strong> fabrice.ribet@gmail.com</p>
                    <p>Vous recevrez votre code d'acc√®s sous 24h apr√®s paiement</p>
                </div>
            </div>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE (cach√©e jusqu'√† validation) -->
    <div id="mainApp" class="main-app">
        <div class="header-container">
            <div class="logo-container">
                <img src="https://i.goopics.net/0opqy7.png" alt="Logo Admin'Quest" class="logo">
            </div>
            <h2 class="subtitle">Pr√©parateur intelligent aux oraux d'administrateur territorial</h2>
            <p class="author">par Fabrice RIBET, pr√©parateur aux concours du CNFPT, administrateur territorial, magistrat financier</p>
            
            <div class="logout-container">
                <button class="logout-btn" onclick="logout()">üö™ D√©connexion</button>
            </div>
        </div>

        <!-- Toggle switch concours/examen pro -->
        <div class="exam-toggle-container">
            <div class="toggle-wrapper">
                <label class="toggle-label">
                    <input type="checkbox" id="examToggle" onchange="switchExamMode()">
                    <span class="toggle-slider"></span>
                </label>
                <div class="toggle-labels">
                    <span id="concours-label" class="active">üéì Concours</span>
                    <span id="examen-label">üìã Examen professionnel</span>
                </div>
            </div>
        </div>

        <!-- Onglets des √©preuves -->
        <div class="tabs-container">
            <div class="tabs">
                <div class="tab active" data-epreuve="all" onclick="switchTab('all')">
                    <span>Toutes les √©preuves</span>
                    <span class="tab-badge" id="count-all">0</span>
                </div>
                <div class="tab" data-epreuve="ENTRETIEN" onclick="switchTab('ENTRETIEN')">
                    <span>Entretien</span>
                    <span class="tab-badge" id="count-entretien">0</span>
                </div>
                <div class="tab" data-epreuve="DGCT" onclick="switchTab('DGCT')">
                    <span>DGCT</span>
                    <span class="tab-badge" id="count-dgct">0</span>
                </div>
                <div class="tab" data-epreuve="QE" onclick="switchTab('QE')">
                    <span>Questions EU</span>
                    <span class="tab-badge" id="count-qe">0</span>
                </div>
                <div class="tab" data-epreuve="QS" onclick="switchTab('QS')">
                    <span>Questions sociales</span>
                    <span class="tab-badge" id="count-qs">0</span>
                </div>
                <div class="tab" data-epreuve="ANGLAIS" onclick="switchTab('ANGLAIS')">
                    <span>Anglais</span>
                    <span class="tab-badge" id="count-anglais">0</span>
                </div>
            </div>
        </div>

        <!-- Showcase des m√©thodes -->
        <div class="methods-showcase">
            <h3>
                <i class="fas fa-tools"></i>
                M√©thodes de pr√©paration disponibles
            </h3>
            <div class="methods-cards">
                <a href="#" class="method-card rafale disabled-link" data-method="rafale" onclick="showMethodInfo('rafale'); return false;">
                    <i class="fas fa-bolt"></i>
                    <span class="method-name">Rafale</span>
                    <span class="method-description">R√©ponse rapide et concise</span>
                </a>
                
                <a href="#" class="method-card enjeux disabled-link" data-method="enjeux" onclick="showMethodInfo('enjeux'); return false;">
                    <i class="fas fa-feather-alt"></i>
                    <span class="method-name">Albatros</span>
                    <span class="method-description">R√©ponse par les enjeux</span>
                </a>
                
                <a href="#" class="method-card poisson disabled-link" data-method="poisson" onclick="showMethodInfo('poisson'); return false;">
                    <i class="fas fa-fish"></i>
                    <span class="method-name">Poisson japonais</span>
                    <span class="method-description">Contextualisation et analyse</span>
                </a>
                
                <a href="#" class="method-card reflexive disabled-link" data-method="reflexive" onclick="showMethodInfo('reflexive'); return false;">
                    <i class="fas fa-brain"></i>
                    <span class="method-name">Analyse r√©flexive</span>
                    <span class="method-description">Exemples structur√©s</span>
                </a>
                
                <a href="#" class="method-card theatre disabled-link" data-method="theatre" onclick="showMethodInfo('theatre'); return false;">
                    <i class="fas fa-theater-masks"></i>
                    <span class="method-name">Pi√®ce de th√©√¢tre</span>
                    <span class="method-description">Mise en situation 3 actes</span>
                </a>
                
                <a href="#" class="method-card technique-longue disabled-link" data-method="technique-longue" onclick="showMethodInfo('technique-longue'); return false;">
                    <i class="fas fa-clipboard-list"></i>
                    <span class="method-name">R√©ponse technique longue</span>
                    <span class="method-description">5 phrases</span>
                </a>
                
                <a href="#" class="method-card technique-courte disabled-link" data-method="technique-courte" onclick="showMethodInfo('technique-courte'); return false;">
                    <i class="fas fa-list"></i>
                    <span class="method-name">R√©ponse technique courte</span>
                    <span class="method-description">2 phrases</span>
                </a>
            </div>
        </div>

        <div class="response-controls">
            <label for="showAutoResponses">Afficher les r√©ponses automatiques:</label>
            <input type="checkbox" id="showAutoResponses">
        </div>
            
        <div class="controls">
            <div>
                <label for="categoryFilter">Cat√©gorie:</label>
                <select id="categoryFilter">
                    <option value="all">Toutes les cat√©gories</option>
                    <option value="1">1. Questions de personnalit√©</option>
                    <option value="2">2. Questions manag√©riales</option>
                    <option value="3">3. Questions de culture territoriale</option>
                    <option value="4">4. Mises en situation</option>
                    <option value="5">5. Questions embarrassantes</option>
                </select>
            </div>
            
            <div>
                <label for="subcategoryFilter">Sous-cat√©gorie:</label>
                <select id="subcategoryFilter">
                    <option value="all">Toutes les sous-cat√©gories</option>
                </select>
            </div>
            
            <div>
                <label for="difficultyFilter">Difficult√©:</label>
                <select id="difficultyFilter">
                    <option value="all">Tous niveaux</option>
                    <option value="1">Niveau 1 - Connaissances fondamentales</option>
                    <option value="2">Niveau 2 - Analyse simple</option>
                    <option value="3">Niveau 3 - Analyse approfondie</option>
                    <option value="4">Niveau 4 - Questions pi√®ges</option>
                </select>
            </div>
            
            <div>
                <label for="searchInput">Recherche:</label>
                <input type="text" id="searchInput" placeholder="Mot-cl√©...">
            </div>
        </div>
        
        <div class="buttons-row">
            <button id="randomButton">Question al√©atoire</button>
            <button id="importButton" class="btn-import">Importer CSV</button>
            <button id="resetButton" class="btn-reset">R√©initialiser filtres</button>
        </div>
        
        <div id="questionsCount"></div>
        
        <div id="questionList"></div>
        
        <footer>
            <p>¬© Fabrice Ribet 2025 - Tous droits r√©serv√©s - Reproduction interdite</p>
        </footer>
    </div>
    
    <script>
        // ===============================
        // SYST√àME DE GESTION D'ABONNEMENT
        // ===============================
        
        // V√©rifier l'abonnement au chargement de la page
        window.addEventListener('DOMContentLoaded', function() {
            const subscription = getValidSubscription();
            if (subscription) {
                showMainApp();
            }
        });
        
        // Fonction pour valider un code d'abonnement
        function validateSubscription() {
            const codeInput = document.getElementById('subscriptionCode');
            const errorDiv = document.getElementById('subscriptionError');
            const successDiv = document.getElementById('subscriptionSuccess');
            const code = codeInput.value.trim().toUpperCase();
            
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            
            if (!code) {
                showError('Veuillez entrer un code d\'acc√®s');
                return;
            }
            
            // R√©cup√©rer la base des abonnements
            const subscriptions = getSubscriptionsDatabase();
            const subscription = subscriptions[code];
            
            if (!subscription) {
                showError('Code d\'acc√®s invalide. V√©rifiez votre saisie ou contactez le support.');
                return;
            }
            
            // V√©rifier si l'abonnement est encore valide
            const now = new Date();
            const endDate = new Date(subscription.endDate);
            
            if (endDate < now) {
                showError('Cet abonnement a expir√© le ' + endDate.toLocaleDateString('fr-FR') + '. Veuillez renouveler votre abonnement.');
                return;
            }
            
            // Sauvegarder l'abonnement valide
            localStorage.setItem('adminquest_subscription', JSON.stringify({
                code: code,
                startDate: subscription.startDate,
                endDate: subscription.endDate,
                email: subscription.email || '',
                validatedAt: new Date().toISOString()
            }));
            
            successDiv.textContent = `Acc√®s valid√© ! Abonnement valide jusqu'au ${endDate.toLocaleDateString('fr-FR')}`;
            successDiv.style.display = 'block';
            
            // Afficher l'application apr√®s un court d√©lai
            setTimeout(showMainApp, 1500);
        }
        
        // Fonction pour afficher l'application principale
        function showMainApp() {
            document.getElementById('subscriptionOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Initialiser l'application
            init();
        }
        
        // Fonction pour d√©connecter l'utilisateur
        function logout() {
            localStorage.removeItem('adminquest_subscription');
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('subscriptionOverlay').style.display = 'flex';
            document.getElementById('subscriptionCode').value = '';
        }
        
        // Fonction pour obtenir un abonnement valide
        function getValidSubscription() {
            try {
                const stored = localStorage.getItem('adminquest_subscription');
                if (!stored) return null;
                
                const subscription = JSON.parse(stored);
                const endDate = new Date(subscription.endDate);
                const now = new Date();
                
                if (endDate > now) {
                    return subscription;
                } else {
                    localStorage.removeItem('adminquest_subscription');
                    return null;
                }
            } catch (e) {
                localStorage.removeItem('adminquest_subscription');
                return null;
            }
        }
        
        // Base de donn√©es des abonnements (√† g√©rer manuellement)
        function getSubscriptionsDatabase() {
            // CETTE FONCTION CONTIENT LES CODES D'ACC√àS VALIDES
            // √Ä mettre √† jour manuellement quand vous vendez de nouveaux abonnements
            return {
                'DEMO2025': {
                    startDate: '2025-01-01',
                    endDate: '2025-12-31',
                    email: 'demo@example.com',
                    type: 'demo'
                },
                'FABRICE2025': {
                    startDate: '2025-01-01',
                    endDate: '2025-12-31',
                    email: 'fabrice.ribet@gmail.com',
                    type: 'admin'
                }
                // AJOUTEZ ICI LES NOUVEAUX CODES MANUELLEMENT
                // Format: 'CODE': { startDate: 'YYYY-MM-DD', endDate: 'YYYY-MM-DD', email: 'email@example.com' }
            };
        }
        
        // Fonction utilitaire pour afficher les erreurs
        function showError(message) {
            const errorDiv = document.getElementById('subscriptionError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        // ===============================
        // APPLICATION PRINCIPALE COMPL√àTE
        // ===============================
        
        // Variables pour stocker les questions
        let questions = [];
        let currentEpreuve = 'all';
        
        // Variables pour g√©rer le mode examen
        let isExamenMode = false;
        const concoursTabs = ['all', 'ENTRETIEN', 'DGCT', 'QE', 'QS', 'ANGLAIS'];
        const examenTabs = ['ENTRETIEN'];
        
        // Toutes les m√©thodes sont disponibles pour toutes les √©preuves
        const methodsByEpreuve = {
            'ENTRETIEN': ['rafale', 'enjeux', 'poisson', 'reflexive', 'theatre', 'technique-courte', 'technique-longue'],
            'DGCT': ['technique-courte', 'technique-longue', 'rafale', 'enjeux', 'poisson', 'reflexive', 'theatre'], 
            'QE': ['technique-courte', 'technique-longue', 'rafale', 'enjeux', 'poisson', 'reflexive', 'theatre'],
            'QS': ['technique-courte', 'technique-longue', 'rafale', 'enjeux', 'poisson', 'reflexive', 'theatre'],
            'ANGLAIS': ['methode_anglais_1', 'methode_anglais_2', 'rafale', 'enjeux']
        };
        
        // Fonction pour afficher les informations sur une m√©thode (pr√©paration pour les liens futurs)
        function showMethodInfo(methodName) {
            const methodDescriptions = {
                'rafale': 'M√©thode de r√©ponse rapide et concise, efficace pour les questions factuelles.',
                'enjeux': 'Technique de l\'Albatros : r√©ponse structur√©e par identification des enjeux principaux.',
                'poisson': 'M√©thode du poisson japonais : contextualisation, analyse et ouverture.',
                'reflexive': 'Analyse r√©flexive bas√©e sur des exemples concrets et structur√©s.',
                'theatre': 'Mise en situation en 3 actes : urgence, mesures, solutions √† moyen terme.',
                'technique-longue': 'R√©ponse technique d√©velopp√©e en 5 phrases pour les √©preuves techniques.',
                'technique-courte': 'R√©ponse technique synth√©tique en 2 phrases pour les √©preuves techniques.'
            };
            
            // Pour l'instant, simple alerte (√† remplacer par une modal ou une nouvelle page)
            alert(`${methodName.toUpperCase()}\n\n${methodDescriptions[methodName]}\n\n(Liens vers pages explicatives √† venir)`);
            
            // TODO: Remplacer par :
            // window.open(`methodes/${methodName}.html`, '_blank');
        }
        
        // √âl√©ments DOM
        let categoryFilter, subcategoryFilter, difficultyFilter, searchInput;
        let randomButton, importButton, resetButton, questionsCount, questionList;
        
        // Mapping des sous-cat√©gories
        const subCategoryNames = {
            "1.1": "Questions de type carte blanche",
            "1.2": "Questions d'opinions citoyennes",
            "1.3": "Questions sur le caract√®re et la personnalit√©",
            "1.4": "Questions de type entretien de recrutement",
            "2.1": "Conception du management",
            "2.2": "Relation aux √©quipes",
            "2.3": "D√©fis manag√©riaux contemporains",
            "2.4": "Relation aux √©lus",
            "2.5": "Situations manag√©riales difficiles",
            "3.1": "Organisation institutionnelle et comp√©tences",
            "3.2": "Finances locales",
            "3.3": "Politiques sectorielles",
            "3.4": "Actualit√© territoriale",
            "3.5": "Europe et collectivit√©s",
            "4.1": "Relations √©lus/administration",
            "4.2": "Gestion de crise",
            "4.3": "Management d'√©quipe",
            "4.4": "D√©ontologie/√©thique professionnelle",
            "4.5": "Relation aux usagers",
            "5.1": "Questions d'opinion sensibles",
            "5.2": "Questions techniques pointues",
            "5.3": "Questions ambigu√´s",
            "5.4": "Questions pi√®ges",
            "5.5": "Questions insistantes"
        };
        
        // Descriptions des niveaux de difficult√©
        const difficultyDescriptions = {
            1: "Connaissances fondamentales",
            2: "Analyse simple",
            3: "Analyse approfondie",
            4: "Questions pi√®ges/embarrassantes"
        };
        
        // Fonction pour peupler les sous-cat√©gories
        function populateSubcategories(category) {
            subcategoryFilter.innerHTML = '<option value="all">Toutes les sous-cat√©gories</option>';
            
            if (category === 'all') {
                Object.entries(subCategoryNames).forEach(([code, name]) => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = name;
                    subcategoryFilter.appendChild(option);
                });
            } else {
                Object.entries(subCategoryNames).forEach(([code, name]) => {
                    if (code.startsWith(category + '.')) {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = name;
                        subcategoryFilter.appendChild(option);
                    }
                });
            }
        }

        // Fonction pour changer d'onglet
        function switchTab(epreuve) {
            // Bloquer si on tente d'acc√©der √† un onglet d√©sactiv√© en mode examen
            const targetTab = document.querySelector(`[data-epreuve="${epreuve}"]`);
            if (targetTab && targetTab.classList.contains('disabled')) {
                return;
            }
            
            // V√©rifier si on est en mode examen et si l'√©preuve est autoris√©e
            if (isExamenMode && epreuve !== 'ENTRETIEN') {
                return;
            }
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (targetTab && !targetTab.classList.contains('disabled')) {
                targetTab.classList.add('active');
            }
            
            currentEpreuve = epreuve;
            filterQuestions();
        }

        // Fonction pour mettre √† jour les compteurs des onglets
        function updateTabCounts() {
            const counts = {
                all: 0, ENTRETIEN: 0, DGCT: 0, QE: 0, QS: 0, ANGLAIS: 0
            };

            questions.forEach(question => {
                counts.all++;
                const epreuves = question.epreuve.split(',').map(e => e.trim());
                epreuves.forEach(epreuve => {
                    if (counts[epreuve] !== undefined) {
                        counts[epreuve]++;
                    }
                });
            });

            document.getElementById('count-all').textContent = counts.all;
            document.getElementById('count-entretien').textContent = counts.ENTRETIEN;
            document.getElementById('count-dgct').textContent = counts.DGCT;
            document.getElementById('count-qe').textContent = counts.QE;
            document.getElementById('count-qs').textContent = counts.QS;
            document.getElementById('count-anglais').textContent = counts.ANGLAIS;
        }

        // Fonction pour le toggle switch concours/examen
        function switchExamMode() {
            const toggle = document.getElementById('examToggle');
            const concoursLabel = document.getElementById('concours-label');
            const examenLabel = document.getElementById('examen-label');
            
            isExamenMode = toggle.checked;
            
            if (isExamenMode) {
                // Mode EXAMEN PROFESSIONNEL - seul ENTRETIEN accessible
                concoursLabel.classList.remove('active');
                examenLabel.classList.add('active');
                
                // Griser et d√©sactiver tous les onglets sauf ENTRETIEN
                document.querySelectorAll('.tab').forEach(tab => {
                    const epreuve = tab.dataset.epreuve;
                    if (epreuve === 'ENTRETIEN') {
                        tab.classList.remove('disabled');
                        tab.classList.add('active');
                        currentEpreuve = 'ENTRETIEN';
                    } else {
                        tab.classList.add('disabled');
                        tab.classList.remove('active');
                        tab.style.pointerEvents = 'none';
                    }
                });
            } else {
                // Mode CONCOURS - tous les onglets accessibles
                examenLabel.classList.remove('active');
                concoursLabel.classList.add('active');
                
                // R√©activer tous les onglets
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('disabled');
                    tab.style.pointerEvents = 'auto';
                });
                
                switchTab('all');
            }
            
            filterQuestions();
        }
        
        // Fonction pour filtrer les questions
        function filterQuestions() {
            const categoryValue = categoryFilter.value;
            const subcategoryValue = subcategoryFilter.value;
            const difficultyValue = difficultyFilter.value;
            const searchValue = searchInput.value.toLowerCase();
            
            let filteredQuestions = questions.filter(question => {
                // Filtre par √©preuve
                const epreuveMatch = isExamenMode ? 
                    question.epreuve.split(',').map(e => e.trim()).includes('ENTRETIEN') :
                    (currentEpreuve === 'all' || 
                     question.epreuve.split(',').map(e => e.trim()).includes(currentEpreuve));
                
                // Autres filtres
                let categoryMatch = categoryValue === 'all' || question.category.toString() === categoryValue;
                let subcategoryMatch = subcategoryValue === 'all' || 
                                      `${question.category}.${question.subCategory}` === subcategoryValue;
                let difficultyMatch = difficultyValue === 'all' || question.difficulty.toString() === difficultyValue;
                let searchMatch = searchValue === '' || 
                                question.question.toLowerCase().includes(searchValue) ||
                                question.keywords.some(k => k.toLowerCase().includes(searchValue));
                
                return epreuveMatch && categoryMatch && subcategoryMatch && difficultyMatch && searchMatch;
            });
            
            displayQuestions(filteredQuestions);
            questionsCount.textContent = `Questions affich√©es : ${filteredQuestions.length} sur ${questions.length}`;
        }

        // Fonction pour obtenir l'ic√¥ne selon le type de r√©ponse
        function getResponseIcon(responseType) {
            switch(responseType) {
                case 'rafale':
                    return '<i class="fas fa-bolt response-icon"></i>';
                case 'enjeux':
                    return '<i class="fas fa-feather-alt response-icon"></i>';
                case 'poisson':
                    return '<i class="fas fa-fish response-icon"></i>';
                case 'reflexive':
                    return '<i class="fas fa-brain response-icon"></i>';
                case 'theatre':
                    return '<i class="fas fa-theater-masks response-icon"></i>';
                case 'technique-longue':
                    return '<i class="fas fa-clipboard-list response-icon"></i>';
                case 'technique-courte':
                    return '<i class="fas fa-list response-icon"></i>';
                default:
                    return '<i class="fas fa-comment response-icon"></i>';
            }
        }
        
        // Fonction pour afficher les questions
        function displayQuestions(filteredQuestions) {
            questionList.innerHTML = '';
            
            if (filteredQuestions.length === 0) {
                questionList.innerHTML = '<p>Aucune question ne correspond aux crit√®res s√©lectionn√©s.</p>';
                return;
            }
            
            filteredQuestions.forEach(question => {
                const container = document.createElement('div');
                container.className = `question-container difficulty-${question.difficulty}`;
                
                const categoryNames = {
                    1: "Personnalit√©",
                    2: "Management",
                    3: "Culture territoriale",
                    4: "Mise en situation",
                    5: "Question embarrassante"
                };
                
                const categoryName = categoryNames[question.category] || "Autre";
                const subCategoryCode = `${question.category}.${question.subCategory}`;
                const subCategoryName = subCategoryNames[subCategoryCode] || "Autre";
                const difficultyDescription = difficultyDescriptions[question.difficulty] || "";
                
                const keywordsHTML = question.keywords.map(keyword => 
                    `<span class="keyword">${keyword}</span>`
                ).join('');
                
                // D√©terminer le type de r√©ponse bas√© sur la m√©thode de r√©ponse
                let responseType = "";
                let labels = ["", "", "", "", ""];
                let responseTitle = "";

                if (question.responseMethod) {
                    const methodLower = question.responseMethod.toLowerCase();
                    
                    if (methodLower.includes("rafale")) {
                        responseType = "rafale";
                        responseTitle = "R√©ponse rapide et concise";
                        labels = ["D√©finition/point cl√©", "Contextualisation", "Nuance/perspective", "", ""];
                    } 
                    else if (methodLower.includes("enjeux") || methodLower.includes("albatros")) {
                        responseType = "enjeux";
                        responseTitle = "R√©ponse par les enjeux (Albatros)";
                        labels = ["Enjeu 1 + point de vue", "Enjeu 2 + point de vue", "Enjeu 3 + point de vue", "", ""];
                    } 
                    else if (methodLower.includes("poisson") || methodLower.includes("japonais")) {
                        responseType = "poisson";
                        responseTitle = "Poisson japonais";
                        labels = ["Contextualisation (t√™te)", "Premi√®re ligne d'analyse (nageoire dorsale)", "Seconde ligne d'analyse (nageoire lat√©rale)", "R√©ponse pr√©cise (collet)", "Ouverture (queue)"];
                    }
                    else if (methodLower.includes("r√©flexive") || methodLower.includes("exemple structur√©")) {
                        responseType = "reflexive";
                        responseTitle = "Analyse r√©flexive";
                        labels = ["Analyse de la situation", "Comp√©tence d√©montr√©e", "Exemple concret", "Difficult√©s rencontr√©es", "Enseignements tir√©s"];
                    }
                    else if (methodLower.includes("pi√®ce de th√©√¢tre") || methodLower.includes("3 actes")) {
                        responseType = "theatre";
                        responseTitle = "Pi√®ce de th√©√¢tre en 3 actes";
                        labels = ["Acte I: Urgence", "Acte I: Mesures imm√©diates", "Acte II: Premi√®res mesures", "Acte II: Communications", "Acte III: Solutions √† moyen terme"];
                    }
                    else if (methodLower.includes("t√©l√©graphe") || methodLower.includes("technique longue") || methodLower.includes("r√©ponse technique longue")) {
                        responseType = "technique-longue";
                        responseTitle = "R√©ponse technique longue (5 phrases)";
                        labels = ["üìã Cadre juridique", "üìä Donn√©es factuelles", "‚öôÔ∏è Enjeux op√©rationnels", "üéØ Position argument√©e", "üîÆ Prospective"];
                    }
                    else if (methodLower.includes("technique courte") || methodLower.includes("r√©ponse technique courte")) {
                        responseType = "technique-courte";
                        responseTitle = "R√©ponse technique courte (2 phrases)";
                        labels = ["üí° Point cl√©", "üìä Donn√©e essentielle", "", "", ""];
                    }
                }

                // Ic√¥ne correspondant au type de r√©ponse
                const responseIcon = getResponseIcon(responseType);

                // Construire le HTML pour la r√©ponse automatique
                let autoResponseHTML = "";
                const hasPhrases = question.phrase1 || question.phrase2 || question.phrase3 || question.phrase4 || question.phrase5;

                if (hasPhrases) {
                    autoResponseHTML = `<div class="auto-response ${responseType}" style="display: none;">
                    <hr>
                    ${responseIcon}
                    <h4>${responseTitle}</h4>`;
                    
                    // Ajouter chaque phrase avec son label si elle existe
                    if (question.phrase1) autoResponseHTML += `<p><strong>${labels[0]}:</strong> ${question.phrase1}</p>`;
                    if (question.phrase2) autoResponseHTML += `<p><strong>${labels[1]}:</strong> ${question.phrase2}</p>`;
                    if (responseType === "technique-longue") {
                        // Pour la r√©ponse technique longue (5 phrases)
                        if (question.phrase3) autoResponseHTML += `<p><strong>${labels[2]}:</strong> ${question.phrase3}</p>`;
                        if (question.phrase4 && labels[3]) autoResponseHTML += `<p><strong>${labels[3]}:</strong> ${question.phrase4}</p>`;
                        if (question.phrase5 && labels[4]) autoResponseHTML += `<p><strong>${labels[4]}:</strong> ${question.phrase5}</p>`;
                    } else if (responseType !== "technique-courte") {
                        // Pour les autres m√©thodes (non techniques)
                        if (question.phrase3) autoResponseHTML += `<p><strong>${labels[2]}:</strong> ${question.phrase3}</p>`;
                        if (question.phrase4 && labels[3]) autoResponseHTML += `<p><strong>${labels[3]}:</strong> ${question.phrase4}</p>`;
                        if (question.phrase5 && labels[4]) autoResponseHTML += `<p><strong>${labels[4]}:</strong> ${question.phrase5}</p>`;
                    }
                    // Pour la r√©ponse technique courte (2 phrases), on s'arr√™te √† phrase2
                    
                    autoResponseHTML += '</div>';
                }
                
                container.innerHTML = `
                    <div class="question">${question.id}: ${question.question}</div>
                    <div class="metadata">
                        Cat√©gorie: ${categoryName}/${subCategoryName} | 
                        Type: ${question.type} | 
                        Difficult√©: Niveau ${question.difficulty} - ${difficultyDescription}
                        ${question.responseMethod ? ` | M√©thode: ${question.responseMethod}` : ''}
                    </div>
                    <div class="attention-points">Points d'attention: ${question.attention}</div>
                    <div class="keywords">${keywordsHTML}</div>
                    ${autoResponseHTML}
                `;
                
                questionList.appendChild(container);
            });
        }
        
        // Fonction pour afficher une question al√©atoire
        function showRandomQuestion() {
            let categoryValue = categoryFilter.value;
            let subcategoryValue = subcategoryFilter.value;
            let difficultyValue = difficultyFilter.value;
            let searchValue = searchInput.value.toLowerCase();
            
            let filteredQuestions = questions.filter(question => {
                let categoryMatch = categoryValue === 'all' || question.category.toString() === categoryValue;
                let subcategoryMatch = subcategoryValue === 'all' || 
                                     `${question.category}.${question.subCategory}` === subcategoryValue;
                let difficultyMatch = difficultyValue === 'all' || question.difficulty.toString() === difficultyValue;
                let searchMatch = searchValue === '' || 
                               question.question.toLowerCase().includes(searchValue) ||
                               question.keywords.some(k => k.toLowerCase().includes(searchValue));
                
                return categoryMatch && subcategoryMatch && difficultyMatch && searchMatch;
            });
            
            if (filteredQuestions.length > 0) {
                const randomIndex = Math.floor(Math.random() * filteredQuestions.length);
                displayQuestions([filteredQuestions[randomIndex]]);
                questionsCount.textContent = `Question al√©atoire (1 sur ${filteredQuestions.length})`;
            } else {
                questionList.innerHTML = '<p>Aucune question ne correspond aux crit√®res pour s√©lection al√©atoire.</p>';
                questionsCount.textContent = 'Aucune question disponible';
            }
        }
        
        // Fonction pour r√©initialiser les filtres
        function resetFilters() {
            categoryFilter.value = 'all';
            populateSubcategories('all');
            difficultyFilter.value = 'all';
            searchInput.value = '';
            filterQuestions();
        }
        
        // Fonction pour importer un fichier CSV
        function importCSV() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        processCSV(event.target.result);
                    };
                    reader.readAsText(file);
                }
                document.body.removeChild(fileInput);
            });
            
            fileInput.click();
        }
        
        // Fonction pour traiter le CSV
        function processCSV(csvContent) {
            Papa.parse(csvContent, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        const processedQuestions = processCSVData(results.data);
                        if (processedQuestions && processedQuestions.length > 0) {
                            questions = processedQuestions;
                            updateTabCounts();
                            try {
                                localStorage.setItem('examQuestions', JSON.stringify(questions));
                            } catch (e) {
                                console.warn("Impossible de sauvegarder dans localStorage:", e);
                            }
                            
                            populateSubcategories('all');
                            filterQuestions();
                            alert(`${questions.length} questions import√©es avec succ√®s !`);
                        } else {
                            alert("Aucune question valide n'a pu √™tre extraite du fichier.");
                        }
                    } else {
                        alert("Le fichier CSV semble vide ou mal format√©.");
                    }
                },
                error: function(error) {
                    console.error("Erreur d'analyse CSV:", error);
                    alert("Erreur lors de l'analyse du fichier CSV.");
                }
            });
        }
        
        // Fonction de traitement des donn√©es CSV
        function processCSVData(csvData) {
            // Fonction pour mapper les cat√©gories
            function mapCategory(mainCat, subCat) {
                const mainCategory = (mainCat || "").toLowerCase();
                const subCategory = (subCat || "").toLowerCase();
                
                if (mainCategory.includes("personnalit√©") || 
                    subCategory.includes("valeur") ||
                    subCategory.includes("aspiration") ||
                    subCategory.includes("caract√®re") ||
                    subCategory.includes("opinion") ||
                    subCategory.includes("personnalit√©")) {
                    return 1;
                }
                
                if (mainCategory.includes("management") || 
                    subCategory.includes("manag√©rial") ||
                    subCategory.includes("leadership") ||
                    subCategory.includes("√©quipe") ||
                    mainCategory.includes("ressources humaines") ||
                    subCategory.includes("management")) {
                    return 2;
                }
                
                if (mainCategory.includes("culture territoriale") || 
                    mainCategory.includes("juridique") ||
                    mainCategory.includes("institution") ||
                    mainCategory.includes("financi√®re") ||
                    subCategory.includes("territorial") ||
                    subCategory.includes("gouvernance")) {
                    return 3;
                }
                
                if (mainCategory.includes("mise en situation") || 
                    subCategory.includes("crise") ||
                    (subCategory.includes("relation") && subCategory.includes("√©lu"))) {
                    return 4;
                }
                
                return 5;
            }
            
            // Fonction pour mapper les sous-cat√©gories
            function mapSubCategory(categoryId, mainCat, subCat) {
                const mainCategory = (mainCat || "").toLowerCase();
                const subCategory = (subCat || "").toLowerCase();
                
                if (categoryId === 1) {
                    if (subCategory.includes("carte blanche") || 
                        subCategory.includes("aspiration") ||
                        subCategory.includes("id√©al")) {
                        return 1;
                    }
                    if (subCategory.includes("citoyen") || 
                        subCategory.includes("opinion") ||
                        subCategory.includes("soci√©t√©")) {
                        return 2;
                    }
                    if (subCategory.includes("caract√®re") || 
                        subCategory.includes("personnalit√©") ||
                        subCategory.includes("analyse de soi")) {
                        return 3;
                    }
                    return 4;
                }
                
                if (categoryId === 2) {
                    if (subCategory.includes("concept") || 
                        subCategory.includes("vision") ||
                        subCategory.includes("th√©orie")) {
                        return 1;
                    }
                    if (subCategory.includes("√©quipe") || 
                        subCategory.includes("relation") ||
                        subCategory.includes("collaboration")) {
                        return 2;
                    }
                    if (subCategory.includes("contemporain") || 
                        subCategory.includes("d√©fi") ||
                        subCategory.includes("num√©rique") ||
                        subCategory.includes("diversit√©")) {
                        return 3;
                    }
                    if (subCategory.includes("√©lu") || 
                        subCategory.includes("politique")) {
                        return 4;
                    }
                    return 5;
                }
                
                if (categoryId === 3) {
                    if (subCategory.includes("institution") || 
                        subCategory.includes("organisation") ||
                        subCategory.includes("comp√©tence")) {
                        return 1;
                    }
                    if (subCategory.includes("finance") || 
                        subCategory.includes("budget") ||
                        subCategory.includes("fiscal")) {
                        return 2;
                    }
                    if (subCategory.includes("sectoriel") || 
                        subCategory.includes("social") ||
                        subCategory.includes("√©ducation") ||
                        subCategory.includes("environnement")) {
                        return 3;
                    }
                    if (subCategory.includes("actualit√©")) {
                        return 4;
                    }
                    return 5;
                }
                
                if (categoryId === 4) {
                    if (subCategory.includes("√©lu") || 
                        subCategory.includes("politique")) {
                        return 1;
                    }
                    if (subCategory.includes("crise")) {
                        return 2;
                    }
                    if (subCategory.includes("√©quipe") || 
                        subCategory.includes("management d'√©quipe")) {
                        return 3;
                    }
                    if (subCategory.includes("√©thique") || 
                        subCategory.includes("d√©ontologie")) {
                        return 4;
                    }
                    return 5;
                }
                
                if (categoryId === 5) {
                    if (subCategory.includes("sensible") || 
                        subCategory.includes("controvers")) {
                        return 1;
                    }
                    if (subCategory.includes("technique") || 
                        subCategory.includes("pointu") ||
                        subCategory.includes("juridique")) {
                        return 2;
                    }
                    if (subCategory.includes("ambigu")) {
                        return 3;
                    }
                    if (subCategory.includes("pi√®ge")) {
                        return 4;
                    }
                    return 5;
                }
                
                return 1;
            }
            
            // Normaliser le niveau de difficult√©
            function normalizeDifficulty(level) {
                if (level === null || level === undefined) return 2;
                
                if (typeof level === 'string') {
                    if (level.includes("Niveau")) {
                        const num = parseInt(level.replace("Niveau ", ""));
                        return Math.min(Math.max(1, num), 4);
                    }
                }
                
                if (typeof level === 'number') {
                    return Math.min(Math.max(1, level), 4);
                }
                
                return 2;
            }
            
            // Transformer les donn√©es
            const structuredQuestions = csvData.map((item, index) => {
                if (!item.Question) return null;
                
                const mainCategory = mapCategory(item["Cat√©gorie principale"], item["Sous-cat√©gorie"]);
                const subCategory = mapSubCategory(mainCategory, item["Cat√©gorie principale"], item["Sous-cat√©gorie"]);
                const difficulty = normalizeDifficulty(item["Niveau de difficult√©"]);
                
                // Type de question
                let type = "Opinion";
                if (item.Question.toLowerCase().includes("que faites-vous") || 
                    item.Question.toLowerCase().includes("comment g√©rez-vous") ||
                    mainCategory === 4) {
                    type = "Mise en situation";
                } else if (item.Question.toLowerCase().includes("qu'est-ce que") || 
                          item.Question.toLowerCase().includes("d√©finissez")) {
                    type = "Factuelle";
                }
                
                // Mots-cl√©s
                const keywords = item["Mots-cl√©s"] ? 
                                item["Mots-cl√©s"].split(",").map(k => k.trim()) : 
                                [];
                
                return {
                    id: `Q${index+1}`,
                    question: item.Question,
                    category: mainCategory,
                    subCategory: subCategory,
                    difficulty: difficulty,
                    type: type,
                    keywords: keywords,
                    attention: item["Points d'attention (√©l√©ments clefs √† consid√©rer)"] || 
                              "Pr√©parez une r√©ponse structur√©e qui d√©montre votre compr√©hension des enjeux.",
                    responseMethod: item["M√©thode de r√©ponse recommand√©e"] || "",
                    // Ajout des phrases pour la r√©ponse automatique
                    phrase1: item["phrase 1"] || "",
                    phrase2: item["phrase 2"] || "",
                    phrase3: item["phrase 3"] || "",
                    phrase4: item["phrase 4"] || "",
                    phrase5: item["phrase 5"] || "",
                    epreuve: item["√âpreuve "] || item["√âpreuve"] || "ENTRETIEN",                   
                    motsClesTransversaux: item["Mots-cl√©s-transversaux"] || ""                     
                };
            }).filter(q => q !== null);
            
            return structuredQuestions;
        }
        
        // Charger des exemples de questions
        function loadSampleQuestions() {
            questions = [
                {
                    id: "Q1",
                    question: "Comment d√©finiriez-vous le r√¥le du manager territorial ?",
                    category: 2,
                    subCategory: 1,
                    difficulty: 2,
                    type: "Opinion",
                    keywords: ["management", "service public", "leadership"],
                    attention: "Montre votre vision du management public. Int√©grer la dimension politique et la sp√©cificit√© du service public.",
                    responseMethod: "Par les enjeux",
                    epreuve: "ENTRETIEN"
                },
                {
                    id: "Q2",
                    question: "La diff√©renciation territoriale est-elle compatible avec l'√©galit√© r√©publicaine ?",
                    category: 3,
                    subCategory: 1,
                    difficulty: 3,
                    type: "Opinion",
                    keywords: ["diff√©renciation", "√©galit√©", "constitution", "adaptation"],
                    attention: "Question au c≈ìur des d√©bats actuels sur l'organisation territoriale. Montrer sa connaissance de la loi 3DS.",
                    responseMethod: "Poisson japonais",
                    epreuve: "ENTRETIEN"
                },
                {
                    id: "Q3",
                    question: "Vous √™tes DGS de la mairie de A (50 000 h). Des ATSEM souhaitent faire valoir leur droit de retrait, car les travaux r√©alis√©s durant l'√©t√© dans les √©coles de la commune ne sont pas termin√©s. Que faites-vous ?",
                    category: 4,
                    subCategory: 3,
                    difficulty: 2,
                    type: "Mise en situation",
                    keywords: ["droit de retrait", "continuit√©", "s√©curit√©", "dialogue"],
                    attention: "Situation testant votre connaissance du droit de retrait et votre capacit√© √† concilier s√©curit√© et continuit√© du service public.",
                    responseMethod: "Pi√®ce de th√©√¢tre en 3 actes",
                    epreuve: "ENTRETIEN"
                },
                {
                    id: "Q4",
                    question: "D√©finissez la notion de p√©r√©quation fiscale horizontale.",
                    category: 3,
                    subCategory: 2,
                    difficulty: 2,
                    type: "Factuelle",
                    keywords: ["p√©r√©quation", "fiscalit√©", "solidarit√© territoriale"],
                    attention: "Question technique n√©cessitant pr√©cision et exemples concrets.",
                    responseMethod: "R√©ponse technique courte",
                    epreuve: "DGCT"
                },
                {
                    id: "Q5",
                    question: "Analysez les enjeux de la transition √©nerg√©tique pour les collectivit√©s territoriales.",
                    category: 3,
                    subCategory: 3,
                    difficulty: 3,
                    type: "Opinion",
                    keywords: ["transition √©nerg√©tique", "d√©veloppement durable", "politique publique"],
                    attention: "Question complexe n√©cessitant une analyse multidimensionnelle.",
                    responseMethod: "R√©ponse technique longue",
                    epreuve: "DGCT"
                },
                {
                    id: "Q6",
                    question: "Quels sont les enjeux de la gouvernance intercommunale ?",
                    category: 3,
                    subCategory: 1,
                    difficulty: 3,
                    type: "Opinion",
                    keywords: ["intercommunalit√©", "gouvernance", "mutualisation"],
                    attention: "Question permettant d'utiliser diff√©rentes m√©thodes selon l'approche souhait√©e.",
                    responseMethod: "Albatros",
                    epreuve: "DGCT"
                }
            ];

            updateTabCounts();
            filterQuestions();
        }
        
        // Initialisation
        function init() {
            // Initialiser les √©l√©ments DOM
            categoryFilter = document.getElementById('categoryFilter');
            subcategoryFilter = document.getElementById('subcategoryFilter');
            difficultyFilter = document.getElementById('difficultyFilter');
            searchInput = document.getElementById('searchInput');
            randomButton = document.getElementById('randomButton');
            importButton = document.getElementById('importButton');
            resetButton = document.getElementById('resetButton');
            questionsCount = document.getElementById('questionsCount');
            questionList = document.getElementById('questionList');
            
            // Essayer de charger des questions du localStorage
            const savedQuestions = localStorage.getItem('examQuestions');
            if (savedQuestions) {
                try {
                    questions = JSON.parse(savedQuestions);
                    populateSubcategories('all');
                    updateTabCounts();
                    filterQuestions();
                } catch (e) {
                    console.error("Erreur lors du chargement des questions:", e);
                    loadSampleQuestions();
                }
            } else {
                loadSampleQuestions();
            }
            
            // √âv√©nements
            categoryFilter.addEventListener('change', function() {
                populateSubcategories(this.value);
                filterQuestions();
            });
            
            subcategoryFilter.addEventListener('change', filterQuestions);
            difficultyFilter.addEventListener('change', filterQuestions);
            searchInput.addEventListener('input', filterQuestions);
            randomButton.addEventListener('click', showRandomQuestion);
            importButton.addEventListener('click', importCSV);
            resetButton.addEventListener('click', resetFilters);
            
            // √âcouteur d'√©v√©nement pour la case √† cocher des r√©ponses automatiques
            const showAutoResponsesCheckbox = document.getElementById('showAutoResponses');
            showAutoResponsesCheckbox.addEventListener('change', function() {
                const autoResponses = document.querySelectorAll('.auto-response');
                autoResponses.forEach(response => {
                    response.style.display = this.checked ? 'block' : 'none';
                });
            });
        }
    </script>
</body>
</html>
