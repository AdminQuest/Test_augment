<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin'Quest - Pr√©parateur intelligent aux oraux d'administrateur territorial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            background-color: #f8f9fa;
        }
        
        /* STYLES POUR L'√âCRAN DE V√âRIFICATION D'ABONNEMENT */
        .subscription-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .subscription-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .subscription-container h2 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subscription-container .subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .subscription-form {
            margin-bottom: 30px;
        }
        
        .subscription-form input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            transition: border-color 0.3s;
        }
        
        .subscription-form input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .subscription-form button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 5px;
        }
        
        .subscription-form button:hover {
            transform: translateY(-2px);
        }
        
        .subscription-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .price-tag {
            font-size: 2.5em;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        
        .features-list {
            text-align: left;
            margin: 20px 0;
        }
        
        .features-list li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .features-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #43a047;
            font-weight: bold;
        }
        
        .payment-section {
            border-top: 2px solid #ecf0f1;
            padding-top: 20px;
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .payment-button {
            padding: 15px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95em;
        }
        
        .payment-button:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }
        
        .payment-button.stripe {
            border-color: #6772e5;
            color: #6772e5;
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
        }
        
        .payment-button.stripe:hover {
            background: #6772e5;
            color: white;
        }
        
        .payment-button.bank {
            border-color: #2ecc71;
            color: #2ecc71;
            background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);
        }
        
        .payment-button.bank:hover {
            background: #2ecc71;
            color: white;
        }
        
        .error-message {
            background: #ffebee;
            border: 1px solid #e74c3c;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .success-message {
            background: #e8f5e9;
            border: 1px solid #43a047;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .contact-info {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 20px;
        }
        
        .payment-note {
            background: #e8f5e9;
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .test-buttons {
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .test-buttons p {
            color: #666;
            margin-bottom: 10px;
        }
        
        .test-buttons button {
            background: #27ae60;
            margin: 2px;
            padding: 5px 10px;
            font-size: 0.8em;
            width: auto;
            display: inline-block;
        }
        
        .test-buttons .debug-btn {
            background: #e67e22;
        }
        
        .test-buttons .fabrice-btn {
            background: #3498db;
        }
        
        /* STYLES POUR L'APPLICATION PRINCIPALE (cach√©e par d√©faut) */
        .main-app {
            display: none;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 20px;
        }
        
        .controls {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .controls div {
            margin-right: 20px;
            margin-bottom: 10px;
        }
        
        select, input {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #bdc3c7;
            width: 200px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .question-container {
            margin-bottom: 15px;
            padding: 15px;
            border-left: 4px solid #3498db;
            background-color: #fff;
            transition: background-color 0.3s;
            border-radius: 5px;
        }
        
        .question-container:hover {
            background-color: #f8f9fa;
        }
        
        .question {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metadata {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        
        .attention-points {
            margin-top: 10px;
            font-style: italic;
        }
        
        .keywords {
            margin-top: 5px;
        }
        
        .keyword {
            background-color: #e74c3c;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 5px;
            display: inline-block;
        }
        
        .hidden {
            display: none;
        }
        
        #searchResults {
            margin-top: 20px;
        }
        
        #questionsCount {
            margin-top: 10px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .buttons-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn-import {
            background-color: #6c757d;
        }
        
        .btn-reset {
            background-color: #6c757d;
        }
        
        .difficulty-1 {
            border-left-color: #2ecc71; /* Vert */
        }
        
        .difficulty-2 {
            border-left-color: #3498db; /* Bleu */
        }
        
        .difficulty-3 {
            border-left-color: #f39c12; /* Orange */
        }
        
        .difficulty-4 {
            border-left-color: #e74c3c; /* Rouge */
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            color: #7f8c8d;
            font-size: 0.9em;
            border-top: 1px solid #ecf0f1;
        }

        .auto-response {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            padding-left: 60px;
        }

        .auto-response h4 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        .auto-response .response-icon {
            position: absolute;
            left: 15px;
            top: 15px;
            font-size: 28px;
        }

        .auto-response p {
            margin: 8px 0;
            line-height: 1.5;
        }

        .auto-response p strong {
            display: inline-block;
            min-width: 160px;
        }

        .auto-response.rafale {
            background-color: #e8f5e9;
            border-left: 5px solid #43a047;
        }
        .auto-response.rafale h4 {
            color: #2e7d32;
        }
        .auto-response.rafale .response-icon {
            color: #2e7d32;
        }

        .auto-response.enjeux {
            background-color: #e3f2fd;
            border-left: 5px solid #1976d2;
        }
        .auto-response.enjeux h4 {
            color: #0d47a1;
        }
        .auto-response.enjeux .response-icon {
            color: #0d47a1;
        }

        .auto-response.poisson {
            background-color: #fff8e1;
            border-left: 5px solid #ffa000;
        }
        .auto-response.poisson h4 {
            color: #e65100;
        }
        .auto-response.poisson .response-icon {
            color: #e65100;
        }

        .auto-response.reflexive {
            background-color: #f3e5f5;
            border-left: 5px solid #8e24aa;
        }
        .auto-response.reflexive h4 {
            color: #4a148c;
        }
        .auto-response.reflexive .response-icon {
            color: #4a148c;
        }

        .auto-response.theatre {
            background-color: #ffebee;
            border-left: 5px solid #e53935;
        }
        .auto-response.theatre h4 {
            color: #b71c1c;
        }
        .auto-response.theatre .response-icon {
            color: #b71c1c;
        }

        .auto-response.technique-longue {
            background-color: #fff3e0;
            border-left: 5px solid #ff6600;
        }
        .auto-response.technique-longue h4 {
            color: #e65100;
        }
        .auto-response.technique-longue .response-icon {
            color: #e65100;
        }

        .auto-response.technique-courte {
            background-color: #f1f8e9;
            border-left: 5px solid #8bc34a;
        }
        .auto-response.technique-courte h4 {
            color: #33691e;
        }
        .auto-response.technique-courte .response-icon {
            color: #33691e;
        }

        .methods-showcase {
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }
        
        .methods-showcase h3 {
            text-align: center;
            margin: 0 0 25px 0;
            color: #2c3e50;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .methods-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }
        
        .method-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 15px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            text-decoration: none;
            display: block;
            position: relative;
            overflow: hidden;
        }
        
        .method-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .method-card:hover::before {
            left: 100%;
        }
        
        .method-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 20px rgba(0,0,0,0.25);
        }
        
        .method-card .method-icon {
            font-size: 2.5em;
            margin-bottom: 12px;
            display: block;
        }
        
        .method-card .method-name {
            font-weight: bold;
            font-size: 1.1em;
            display: block;
            margin-bottom: 8px;
        }
        
        .method-card .method-description {
            opacity: 0.9;
            font-size: 0.85em;
            line-height: 1.3;
        }

        .method-card.rafale { 
            background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%); 
        }
        .method-card.enjeux { 
            background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%); 
        }
        .method-card.poisson { 
            background: linear-gradient(135deg, #ffa000 0%, #e65100 100%); 
        }
        .method-card.reflexive { 
            background: linear-gradient(135deg, #8e24aa 0%, #4a148c 100%); 
        }
        .method-card.theatre { 
            background: linear-gradient(135deg, #e53935 0%, #b71c1c 100%); 
        }
        .method-card.technique-longue { 
            background: linear-gradient(135deg, #ff6600 0%, #e65100 100%); 
        }
        .method-card.technique-courte { 
            background: linear-gradient(135deg, #8bc34a 0%, #33691e 100%); 
        }

        .method-card.disabled-link {
            cursor: default;
        }
        
        .method-card.disabled-link:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .response-controls {
            background-color: #fff;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .response-controls label {
            margin-right: 10px;
        }

        .header-container {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .logo {
            height: 400px;
            margin-right: 15px;
        }
        
        .subtitle {
            color: #3498db;
            margin: 15px 0;
            font-size: 1.5em;
            font-weight: normal;
        }

        .author {
            font-size: 1em;
            color: #7f8c8d;
            margin-top: 10px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .exam-toggle-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .toggle-label {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-label input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3498db;
            transition: .4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #e74c3c;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .toggle-labels {
            display: flex;
            gap: 20px;
        }

        .toggle-labels span {
            color: white;
            font-weight: bold;
            font-size: 1.1em;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .toggle-labels span.active {
            opacity: 1;
            text-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        .tabs-container {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tabs {
            display: flex;
            background-color: #fff;
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            flex-wrap: wrap;
        }

        .tab {
            color: #2c3e50;
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-bottom: none;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            font-weight: 500;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 150px;
        }

        .tab[data-epreuve="all"]::before {
            content: "üéì";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="ENTRETIEN"]::before {
            content: "üë®‚Äçüíº";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="DGCT"]::before {
            content: "üèõÔ∏è";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="QE"]::before {
            content: "‚≠ê";
            font-size: 1.5em;
            color: #1E90FF;
        }
        
        .tab[data-epreuve="QS"]::before {
            content: "ü§ù";
            font-size: 1.5em;
        }
        
        .tab[data-epreuve="ANGLAIS"]::before {
            content: "üí¨";
            font-size: 1.5em;
            color: #DC143C;
        }

        .tab[data-epreuve="all"] {
            background-color: #ecf0f1;
        }
        
        .tab[data-epreuve="ENTRETIEN"] {
            background-color: #bbdefb;
        }
        
        .tab[data-epreuve="DGCT"] {
            background-color: #c8e6c9;
        }
        
        .tab[data-epreuve="QE"] {
            background-color: #ffe0b2;
        }
        
        .tab[data-epreuve="QS"] {
            background-color: #e1bee7;
        }
        
        .tab[data-epreuve="ANGLAIS"] {
            background-color: #ffcdd2;
        }

        .tab:hover {
            filter: brightness(0.9);
        }

        .tab.active {
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid #333;
        }

        .tab.active[data-epreuve="all"] {
            background-color: #7f8c8d;
        }
        
        .tab.active[data-epreuve="ENTRETIEN"] {
            background-color: #1976d2;
        }
        
        .tab.active[data-epreuve="DGCT"] {
            background-color: #388e3c;
        }
        
        .tab.active[data-epreuve="QE"] {
            background-color: #f57c00;
        }
        
        .tab.active[data-epreuve="QS"] {
            background-color: #7b1fa2;
        }
        
        .tab.active[data-epreuve="ANGLAIS"] {
            background-color: #c62828;
        }

        .tab.active::after {
            content: "üëë";
            font-size: 1.2em;
            margin-left: 8px;
        }

        .tab-badge {
            background-color: rgba(255,255,255,0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .tab.disabled {
            background-color: #bdc3c7 !important;
            color: #7f8c8d !important;
            opacity: 0.5;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        .tab.disabled:hover {
            background-color: #bdc3c7 !important;
            transform: none !important;
            filter: none !important;
        }

        .tab.disabled .tab-badge {
            background-color: rgba(0,0,0,0.2) !important;
        }

        .tab.active[data-epreuve="QE"]::before {
            color: #fff;
        }
        
        .tab.active[data-epreuve="ANGLAIS"]::before {
            color: #fff;
        }

        /* Bouton de d√©connexion dans l'app */
        .logout-container {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .subscription-container {
                padding: 20px;
                margin: 10px;
            }
            
            .price-tag {
                font-size: 2em;
            }
            
            .payment-methods {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .methods-cards {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .method-card {
                padding: 20px 10px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9em;
                min-width: auto;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .controls div {
                margin-right: 0;
            }
            
            select, input {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- √âCRAN DE V√âRIFICATION D'ABONNEMENT -->
    <div id="subscriptionOverlay" class="subscription-overlay">
        <div class="subscription-container">
            <h2>üéì Admin'Quest</h2>
            <p class="subtitle">Pr√©parateur intelligent aux oraux d'administrateur territorial</p>
            
            <div id="subscriptionForm" class="subscription-form">
                <h3>Acc√®s par code d'abonnement</h3>
                <input type="text" id="subscriptionCode" placeholder="Entrez votre code d'acc√®s" maxlength="20">
                <button onclick="validateSubscription()">Valider l'acc√®s</button>
                
                <!-- Boutons de test rapide -->
                <div class="test-buttons">
                    <p>üß™ <strong>Codes de test :</strong></p>
                    <button onclick="testDemo()">Test DEMO2025</button>
                    <button onclick="testFabrice()" class="fabrice-btn">Test FABRICE2025</button>
                    <button onclick="testI90UB9F2()" style="background: #9b59b6;">Test I90UB9F2</button>
                    <button onclick="testDebug()" class="debug-btn">üîç Debug</button>
                </div>
                
                <div id="subscriptionError" class="error-message"></div>
                <div id="subscriptionSuccess" class="success-message"></div>
            </div>
            
            <div class="subscription-info">
                <h3>Abonnement Annuel</h3>
                <div class="price-tag">29‚Ç¨</div>
                <ul class="features-list">
                    <li>üóÉÔ∏è Base de donn√©es de 700+ questions d'oraux</li>
                    <li>üéØ 7 m√©thodes de r√©ponse structur√©es</li>
                    <li>üìä Filtrage par √©preuve, difficult√© et cat√©gorie</li>
                    <li>üé™ Mode examen professionnel</li>
                    <li>üí° R√©ponses automatiques d√©taill√©es</li>
                    <li>üì± Interface responsive</li>
                    <li>üîÑ Mises √† jour r√©guli√®res</li>
                </ul>
            </div>
            
            <div class="payment-section">
                <h4>üí≥ Commandez votre abonnement :</h4>
                
                <div class="payment-note">
                    <strong>üí° Recommandation :</strong> Stripe (paiement s√©curis√©, confirmation imm√©diate) ou virement bancaire (sans frais)
                </div>
                
                <div class="payment-methods">
                    <a href="https://buy.stripe.com/14A28r0We3QQ8TQ5rJdfG01" target="_blank" class="payment-button stripe">
                        üí≥ Stripe (29‚Ç¨) - RECOMMAND√â
                    </a>
                    
                    <a href="/cdn-cgi/l/email-protection#284e494a5a414b4d065a414a4d5c684f45494144064b4745175b5d4a424d4b5c15694c4541460f795d4d5b5c0d1a18050d1a187e415a4d454d465c0d1a184a49464b49415a4d0e4a474c51156a474642475d5a0d1a186e494a5a414b4d0d1a6b0d18690d1869624d0d1a185b475d4049415c4d0d1a184b47454549464c4d5a0d1a185d460d1a18494a4746464d454d465c0d1a18694c4541460d1a1f795d4d5b5c0d1a1858475d5a0d1a18111f0d6d1a0d101a0d696b0d1a1858495a0d1a185e415a4d454d465c0d1a184a49464b49415a4d060d18690d18696547460d1a184647450d1a180d1b690d1a180d18696547460d1a184d454941440d1a180d1b690d1a180d18690d1869654d5a4b410d1a184c4d0d1a18454d0d1a184b4745455d4641595d4d5a0d1a185e475b0d1a184b47475a4c4746460d6b1b0d69114d5b0d1a184a49464b49415a4d5b060d18690d18696b475a4c4149444d454d465c" class="payment-button bank">
                        üè¶ Virement (29‚Ç¨)
                    </a>
                    
                    <a href="/cdn-cgi/l/email-protection#bcdadddeced5dfd992ced5ded9c8fcdbd1ddd5d092dfd3d183cfc9ded6d9dfc881fdd8d1d5d29bedc9d9cfc8998e8c91998e8cffd3d1d1ddd2d8d99aded3d8c581fed3d2d6d3c9ce998e8cfadddeced5dfd9998eff998cfd998cfdf6d9998e8ccfd3c9d4ddd5c8d9998e8cdfd3d1d1ddd2d8d9ce998e8cc9d2998e8cddded3d2d2d9d1d9d2c8998e8cfdd8d1d5d2998e8bedc9d9cfc8998e8cccd3c9ce998e8c858b99f98e99848e99fdff92998cfd998cfdf1d3d2998e8cd2d3d1998e8c998ffd998e8c998cfdf1d3d2998e8cd9d1ddd5d0998e8c998ffd998e8c998cfdf1d3d2998e8cd1d3d8d9998e8cd8d9998e8cccddd5d9d1d9d2c8998e8ccfd3c9d4ddd5c899ff8f99fd85998e8c998ffd998e8c998cfd998cfdffd3ced8d5ddd0d9d1d9d2c8" class="payment-button">
                        üìß Autre moyen
                    </a>
                </div>
                
                <div class="contact-info">
                    <p><strong>üìû Contact :</strong> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1c7a7d7e6e757f79326e757e79685c7b717d7570327f7371">[email&#160;protected]</a></p>
                    <p><strong>‚è±Ô∏è Livraison :</strong> Code d'acc√®s sous 24h apr√®s confirmation de paiement</p>
                    <p><strong>üõ°Ô∏è Garantie :</strong> Satisfait ou rembours√©</p>
                    <p><strong>üß™ Mode test :</strong> <em>Stripe est en mode test - Aucun vrai paiement pour l'instant</em></p>
                </div>
            </div>
        </div>
    </div>

    <!-- APPLICATION PRINCIPALE (cach√©e jusqu'√† validation) -->
    <div id="mainApp" class="main-app">
        <div class="header-container">
            <div class="logo-container">
                <img src="https://i.goopics.net/0opqy7.png" alt="Logo Admin'Quest" class="logo">
            </div>
            <h2 class="subtitle">Pr√©parateur intelligent aux oraux d'administrateur territorial</h2>
            <p class="author">par Fabrice RIBET, pr√©parateur aux concours du CNFPT, administrateur territorial, magistrat financier</p>
            
            <div class="logout-container">
                <button class="logout-btn" onclick="logout()">üö™ D√©connexion</button>
            </div>
        </div>

        <!-- Toggle switch concours/examen pro -->
        <div class="exam-toggle-container">
            <div class="toggle-wrapper">
                <label class="toggle-label">
                    <input type="checkbox" id="examToggle" onchange="switchExamMode()">
                    <span class="toggle-slider"></span>
                </label>
                <div class="toggle-labels">
                    <span id="concours-label" class="active">üéì Concours</span>
                    <span id="examen-label">üìã Examen professionnel</span>
                </div>
            </div>
        </div>

        <!-- Onglets des √©preuves -->
        <div class="tabs-container">
            <div class="tabs">
                <div class="tab active" data-epreuve="all" onclick="switchTab('all')">
                    <span>Toutes les √©preuves</span>
                    <span class="tab-badge" id="count-all">0</span>
                </div>
                <div class="tab" data-epreuve="ENTRETIEN" onclick="switchTab('ENTRETIEN')">
                    <span>Entretien</span>
                    <span class="tab-badge" id="count-entretien">0</span>
                </div>
                <div class="tab" data-epreuve="DGCT" onclick="switchTab('DGCT')">
                    <span>DGCT</span>
                    <span class="tab-badge" id="count-dgct">0</span>
                </div>
                <div class="tab" data-epreuve="QE" onclick="switchTab('QE')">
                    <span>Questions EU</span>
                    <span class="tab-badge" id="count-qe">0</span>
                </div>
                <div class="tab" data-epreuve="QS" onclick="switchTab('QS')">
                    <span>Questions sociales</span>
                    <span class="tab-badge" id="count-qs">0</span>
                </div>
                <div class="tab" data-epreuve="ANGLAIS" onclick="switchTab('ANGLAIS')">
                    <span>Anglais</span>
                    <span class="tab-badge" id="count-anglais">0</span>
                </div>
            </div>
        </div>

        <!-- Showcase des m√©thodes -->
        <div class="methods-showcase">
            <h3>
                <i class="fas fa-tools"></i>
                M√©thodes de pr√©paration disponibles
            </h3>
            <div class="methods-cards">
                <div class="method-card rafale disabled-link" data-method="rafale" onclick="showMethodInfo('rafale')">
                    <span class="method-icon">‚ö°</span>
                    <span class="method-name">Rafale</span>
                    <span class="method-description">R√©ponse rapide et concise</span>
                </div>
                
                <div class="method-card enjeux disabled-link" data-method="enjeux" onclick="showMethodInfo('enjeux')">
                    <span class="method-icon">ü™∂</span>
                    <span class="method-name">Albatros</span>
                    <span class="method-description">R√©ponse par les enjeux</span>
                </div>
                
                <div class="method-card poisson disabled-link" data-method="poisson" onclick="showMethodInfo('poisson')">
                    <span class="method-icon">üêü</span>
                    <span class="method-name">Poisson japonais</span>
                    <span class="method-description">Contextualisation et analyse</span>
                </div>
                
                <div class="method-card reflexive disabled-link" data-method="reflexive" onclick="showMethodInfo('reflexive')">
                    <span class="method-icon">üß†</span>
                    <span class="method-name">Analyse r√©flexive</span>
                    <span class="method-description">Exemples structur√©s</span>
                </div>
                
                <div class="method-card theatre disabled-link" data-method="theatre" onclick="showMethodInfo('theatre')">
                    <span class="method-icon">üé≠</span>
                    <span class="method-name">Pi√®ce de th√©√¢tre</span>
                    <span class="method-description">Mise en situation 3 actes</span>
                </div>
                
                <div class="method-card technique-longue disabled-link" data-method="technique-longue" onclick="showMethodInfo('technique-longue')">
                    <span class="method-icon">üìã</span>
                    <span class="method-name">R√©ponse technique longue</span>
                    <span class="method-description">5 phrases</span>
                </div>
                
                <div class="method-card technique-courte disabled-link" data-method="technique-courte" onclick="showMethodInfo('technique-courte')">
                    <span class="method-icon">üìù</span>
                    <span class="method-name">R√©ponse technique courte</span>
                    <span class="method-description">2 phrases</span>
                </div>
            </div>
        </div>

        <div class="response-controls">
            <label for="showAutoResponses">Afficher les r√©ponses automatiques:</label>
            <input type="checkbox" id="showAutoResponses">
        </div>
            
        <div class="controls">
            <div>
                <label for="categoryFilter">Cat√©gorie:</label>
                <select id="categoryFilter">
                    <option value="all">Toutes les cat√©gories</option>
                    <option value="1">1. Questions de personnalit√©</option>
                    <option value="2">2. Questions manag√©riales</option>
                    <option value="3">3. Questions de culture territoriale</option>
                    <option value="4">4. Mises en situation</option>
                    <option value="5">5. Questions embarrassantes</option>
                </select>
            </div>
            
            <div>
                <label for="subcategoryFilter">Sous-cat√©gorie:</label>
                <select id="subcategoryFilter">
                    <option value="all">Toutes les sous-cat√©gories</option>
                </select>
            </div>
            
            <div>
                <label for="difficultyFilter">Difficult√©:</label>
                <select id="difficultyFilter">
                    <option value="all">Tous niveaux</option>
                    <option value="1">Niveau 1 - Connaissances fondamentales</option>
                    <option value="2">Niveau 2 - Analyse simple</option>
                    <option value="3">Niveau 3 - Analyse approfondie</option>
                    <option value="4">Niveau 4 - Questions pi√®ges</option>
                </select>
            </div>
            
            <div>
                <label for="searchInput">Recherche:</label>
                <input type="text" id="searchInput" placeholder="Mot-cl√©...">
            </div>
        </div>
        
        <div class="buttons-row">
            <button id="randomButton">Question al√©atoire</button>
            <button id="importButton" class="btn-import">Importer CSV</button>
            <button id="resetButton" class="btn-reset">R√©initialiser filtres</button>
        </div>
        
        <div id="questionsCount"></div>
        
        <div id="questionList"></div>
        
        <footer>
            <p>¬© Fabrice Ribet 2025 - Tous droits r√©serv√©s - Reproduction interdite</p>
        </footer>
    </div>
    
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ===============================
        // VARIABLES GLOBALES
        // ===============================
        console.log("üîç Script Admin'Quest charg√© - Version compl√®te");
        
        // Variables pour stocker les questions
        let questions = [];
        let currentEpreuve = 'all';
        
        // Variables pour g√©rer le mode examen
        let isExamenMode = false;
        
        // √âl√©ments DOM
        let categoryFilter, subcategoryFilter, difficultyFilter, searchInput;
        let randomButton, importButton, resetButton, questionsCount, questionList;
        
        // Mapping des sous-cat√©gories
        const subCategoryNames = {
            "1.1": "Questions de type carte blanche",
            "1.2": "Questions d'opinions citoyennes",
            "1.3": "Questions sur le caract√®re et la personnalit√©",
            "1.4": "Questions de type entretien de recrutement",
            "2.1": "Conception du management",
            "2.2": "Relation aux √©quipes",
            "2.3": "D√©fis manag√©riaux contemporains",
            "2.4": "Relation aux √©lus",
            "2.5": "Situations manag√©riales difficiles",
            "3.1": "Organisation institutionnelle et comp√©tences",
            "3.2": "Finances locales",
            "3.3": "Politiques sectorielles",
            "3.4": "Actualit√© territoriale",
            "3.5": "Europe et collectivit√©s",
            "4.1": "Relations √©lus/administration",
            "4.2": "Gestion de crise",
            "4.3": "Management d'√©quipe",
            "4.4": "D√©ontologie/√©thique professionnelle",
            "4.5": "Relation aux usagers",
            "5.1": "Questions d'opinion sensibles",
            "5.2": "Questions techniques pointues",
            "5.3": "Questions ambigu√´s",
            "5.4": "Questions pi√®ges",
            "5.5": "Questions insistantes"
        };
        
        // Descriptions des niveaux de difficult√©
        const difficultyDescriptions = {
            1: "Connaissances fondamentales",
            2: "Analyse simple",
            3: "Analyse approfondie",
            4: "Questions pi√®ges/embarrassantes"
        };
        
        // ===============================
        // SYST√àME DE GESTION D'ABONNEMENT
        // ===============================
        
        // Base de donn√©es des abonnements (√† g√©rer manuellement)
        function getSubscriptionsDatabase() {
            return {
                'DEMO2025': {
                    startDate: '2025-01-01',
                    endDate: '2025-12-31',
                    email: 'demo@example.com',
                    type: 'demo'
                },
                'FABRICE2025': {
                    startDate: '2025-01-01',
                    endDate: '2025-12-31',
                    email: 'fabrice.ribet@gmail.com',
                    type: 'admin'
                },
                'I90UB9F2': {
                    startDate: '2025-11-29',
                    endDate: '2026-11-29',
                    email: 'copeau@gmail.com',
                    type: 'standard'
                }
            };
        }
        
        // Fonction utilitaire pour afficher les erreurs
        function showError(message) {
            console.log("üîç Erreur:", message);
            const errorDiv = document.getElementById('subscriptionError');
            const successDiv = document.getElementById('subscriptionSuccess');
            
            if (errorDiv && successDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                successDiv.style.display = 'none';
            }
        }
        
        // Fonction utilitaire pour afficher les succ√®s
        function showSuccess(message) {
            console.log("üîç Succ√®s:", message);
            const errorDiv = document.getElementById('subscriptionError');
            const successDiv = document.getElementById('subscriptionSuccess');
            
            if (errorDiv && successDiv) {
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                errorDiv.style.display = 'none';
            }
        }
        
        // Fonction pour valider un code d'abonnement
        function validateSubscription() {
            console.log("üîç validateSubscription() appel√©e");
            
            const codeInput = document.getElementById('subscriptionCode');
            if (!codeInput) {
                console.error("üîç Element subscriptionCode non trouv√©");
                return;
            }
            
            const code = codeInput.value.trim().toUpperCase();
            console.log("üîç Code saisi:", code);
            
            if (!code) {
                showError('Veuillez entrer un code d\'acc√®s');
                return;
            }
            
            // R√©cup√©rer la base des abonnements
            const subscriptions = getSubscriptionsDatabase();
            console.log("üîç Base des abonnements:", subscriptions);
            
            const subscription = subscriptions[code];
            console.log("üîç Abonnement trouv√©:", subscription);
            
            if (!subscription) {
                showError('Code d\'acc√®s invalide. Codes de test : DEMO2025, FABRICE2025, I90UB9F2');
                return;
            }
            
            // V√©rifier si l'abonnement est encore valide
            const now = new Date();
            const endDate = new Date(subscription.endDate);
            
            console.log("üîç Date maintenant:", now);
            console.log("üîç Date fin:", endDate);
            console.log("üîç Valide:", endDate > now);
            
            if (endDate < now) {
                showError('Cet abonnement a expir√© le ' + endDate.toLocaleDateString('fr-FR') + '. Veuillez renouveler votre abonnement.');
                return;
            }
            
            // Sauvegarder l'abonnement valide
            const subscriptionData = {
                code: code,
                startDate: subscription.startDate,
                endDate: subscription.endDate,
                email: subscription.email || '',
                validatedAt: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('adminquest_subscription', JSON.stringify(subscriptionData));
                console.log("üîç Donn√©es sauvegard√©es:", subscriptionData);
            } catch(e) {
                console.error("üîç Erreur localStorage:", e);
                showError('Erreur de sauvegarde. Essayez un autre navigateur.');
                return;
            }
            
            showSuccess(`Acc√®s valid√© ! Abonnement valide jusqu'au ${endDate.toLocaleDateString('fr-FR')}`);
            
            console.log("üîç Validation r√©ussie, d√©marrage app dans 1.5s");
            setTimeout(showMainApp, 1500);
        }
        
        // Fonction pour afficher l'application principale
        function showMainApp() {
            console.log("üîç showMainApp() appel√©e");
            
            const overlay = document.getElementById('subscriptionOverlay');
            const mainApp = document.getElementById('mainApp');
            
            if (overlay && mainApp) {
                overlay.style.display = 'none';
                mainApp.style.display = 'block';
                console.log("üîç Interface bascul√©e vers l'app principale");
                
                // Initialiser l'application compl√®te
                try {
                    init();
                    console.log("üîç Application initialis√©e avec succ√®s");
                } catch(e) {
                    console.error("üîç Erreur initialisation:", e);
                }
            } else {
                console.error("üîç √âl√©ments DOM non trouv√©s:", {overlay: !!overlay, mainApp: !!mainApp});
            }
        }
        
        // Fonction pour d√©connecter l'utilisateur
        function logout() {
            console.log("üîç logout() appel√©e");
            localStorage.removeItem('adminquest_subscription');
            location.reload();
        }
        
        // Fonction pour obtenir un abonnement valide
        function getValidSubscription() {
            try {
                const stored = localStorage.getItem('adminquest_subscription');
                if (!stored) return null;
                
                const subscription = JSON.parse(stored);
                const endDate = new Date(subscription.endDate);
                const now = new Date();
                
                if (endDate > now) {
                    console.log("üîç Abonnement valide trouv√©:", subscription);
                    return subscription;
                } else {
                    console.log("üîç Abonnement expir√©, suppression");
                    localStorage.removeItem('adminquest_subscription');
                    return null;
                }
            } catch (e) {
                console.log("üîç Erreur lecture localStorage:", e);
                localStorage.removeItem('adminquest_subscription');
                return null;
            }
        }
        
        // Fonctions de test rapide
        function testDemo() {
            console.log("üîç testDemo() appel√©e");
            document.getElementById('subscriptionCode').value = 'DEMO2025';
            validateSubscription();
        }
        
        function testFabrice() {
            console.log("üîç testFabrice() appel√©e");
            document.getElementById('subscriptionCode').value = 'FABRICE2025';
            validateSubscription();
        }
        
        function testI90UB9F2() {
            console.log("üîç testI90UB9F2() appel√©e");
            document.getElementById('subscriptionCode').value = 'I90UB9F2';
            validateSubscription();
        }
        
        // Fonction de debug
        function testDebug() {
            console.log("=== üîç DEBUG ADMIN'QUEST ===");
            
            const subscriptions = getSubscriptionsDatabase();
            console.log("1. Base des abonnements:", subscriptions);
            console.log("2. DEMO2025:", subscriptions['DEMO2025']);
            console.log("3. FABRICE2025:", subscriptions['FABRICE2025']);
            console.log("4. I90UB9F2:", subscriptions['I90UB9F2']);
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                console.log("4. localStorage: ‚úÖ OK");
            } catch(e) {
                console.log("4. localStorage: ‚ùå ERREUR", e);
            }
            
            // Test DOM
            const elements = {
                subscriptionCode: document.getElementById('subscriptionCode'),
                subscriptionError: document.getElementById('subscriptionError'),
                subscriptionSuccess: document.getElementById('subscriptionSuccess'),
                subscriptionOverlay: document.getElementById('subscriptionOverlay'),
                mainApp: document.getElementById('mainApp')
            };
            
            console.log("5. √âl√©ments DOM:");
            for (const [name, element] of Object.entries(elements)) {
                console.log(`   - ${name}: ${!!element}`);
            }
            
            // Test dates
            const now = new Date();
            const endDate = new Date('2025-12-31');
            console.log("6. Test dates:");
            console.log("   - Maintenant:", now);
            console.log("   - Fin 2025:", endDate);
            console.log("   - Valide:", endDate > now);
            
            // V√©rifier abonnement existant
            const existing = getValidSubscription();
            console.log("7. Abonnement existant:", existing);
            
            alert("üîç Debug termin√© - Regardez la console (F12) pour les d√©tails");
        }
        
        // ===============================
        // APPLICATION PRINCIPALE
        // ===============================
        
        // Fonction pour peupler les sous-cat√©gories
        function populateSubcategories(category) {
            subcategoryFilter.innerHTML = '<option value="all">Toutes les sous-cat√©gories</option>';
            
            if (category === 'all') {
                Object.entries(subCategoryNames).forEach(([code, name]) => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = name;
                    subcategoryFilter.appendChild(option);
                });
            } else {
                Object.entries(subCategoryNames).forEach(([code, name]) => {
                    if (code.startsWith(category + '.')) {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = name;
                        subcategoryFilter.appendChild(option);
                    }
                });
            }
        }

        // Fonction pour changer d'onglet
        function switchTab(epreuve) {
            // Bloquer si on tente d'acc√©der √† un onglet d√©sactiv√© en mode examen
            const targetTab = document.querySelector(`[data-epreuve="${epreuve}"]`);
            if (targetTab && targetTab.classList.contains('disabled')) {
                return;
            }
            
            // V√©rifier si on est en mode examen et si l'√©preuve est autoris√©e
            if (isExamenMode && epreuve !== 'ENTRETIEN') {
                return;
            }
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (targetTab && !targetTab.classList.contains('disabled')) {
                targetTab.classList.add('active');
            }
            
            currentEpreuve = epreuve;
            filterQuestions();
        }

        // Fonction pour mettre √† jour les compteurs des onglets
        function updateTabCounts() {
            const counts = {
                all: 0, ENTRETIEN: 0, DGCT: 0, QE: 0, QS: 0, ANGLAIS: 0
            };

            questions.forEach(question => {
                counts.all++;
                const epreuves = question.epreuve.split(',').map(e => e.trim());
                epreuves.forEach(epreuve => {
                    if (counts[epreuve] !== undefined) {
                        counts[epreuve]++;
                    }
                });
            });

            document.getElementById('count-all').textContent = counts.all;
            document.getElementById('count-entretien').textContent = counts.ENTRETIEN;
            document.getElementById('count-dgct').textContent = counts.DGCT;
            document.getElementById('count-qe').textContent = counts.QE;
            document.getElementById('count-qs').textContent = counts.QS;
            document.getElementById('count-anglais').textContent = counts.ANGLAIS;
        }

        // Fonction pour le toggle switch concours/examen
        function switchExamMode() {
            const toggle = document.getElementById('examToggle');
            const concoursLabel = document.getElementById('concours-label');
            const examenLabel = document.getElementById('examen-label');
            
            isExamenMode = toggle.checked;
            
            if (isExamenMode) {
                // Mode EXAMEN PROFESSIONNEL - seul ENTRETIEN accessible
                concoursLabel.classList.remove('active');
                examenLabel.classList.add('active');
                
                // Griser et d√©sactiver tous les onglets sauf ENTRETIEN
                document.querySelectorAll('.tab').forEach(tab => {
                    const epreuve = tab.dataset.epreuve;
                    if (epreuve === 'ENTRETIEN') {
                        tab.classList.remove('disabled');
                        tab.classList.add('active');
                        currentEpreuve = 'ENTRETIEN';
                    } else {
                        tab.classList.add('disabled');
                        tab.classList.remove('active');
                        tab.style.pointerEvents = 'none';
                    }
                });
            } else {
                // Mode CONCOURS - tous les onglets accessibles
                examenLabel.classList.remove('active');
                concoursLabel.classList.add('active');
                
                // R√©activer tous les onglets
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.remove('disabled');
                    tab.style.pointerEvents = 'auto';
                });
                
                switchTab('all');
            }
            
            filterQuestions();
        }
        
        // Fonction pour filtrer les questions
        function filterQuestions() {
            const categoryValue = categoryFilter.value;
            const subcategoryValue = subcategoryFilter.value;
            const difficultyValue = difficultyFilter.value;
            const searchValue = searchInput.value.toLowerCase();
            
            let filteredQuestions = questions.filter(question => {
                // Filtre par √©preuve
                const epreuveMatch = isExamenMode ? 
                    question.epreuve.split(',').map(e => e.trim()).includes('ENTRETIEN') :
                    (currentEpreuve === 'all' || 
                     question.epreuve.split(',').map(e => e.trim()).includes(currentEpreuve));
                
                // Autres filtres
                let categoryMatch = categoryValue === 'all' || question.category.toString() === categoryValue;
                let subcategoryMatch = subcategoryValue === 'all' || 
                                      `${question.category}.${question.subCategory}` === subcategoryValue;
                let difficultyMatch = difficultyValue === 'all' || question.difficulty.toString() === difficultyValue;
                let searchMatch = searchValue === '' || 
                                question.question.toLowerCase().includes(searchValue) ||
                                question.keywords.some(k => k.toLowerCase().includes(searchValue));
                
                return epreuveMatch && categoryMatch && subcategoryMatch && difficultyMatch && searchMatch;
            });
            
            displayQuestions(filteredQuestions);
            questionsCount.textContent = `Questions affich√©es : ${filteredQuestions.length} sur ${questions.length}`;
        }

        // Fonction pour obtenir l'ic√¥ne selon le type de r√©ponse
        function getResponseIcon(responseType) {
            switch(responseType) {
                case 'rafale':
                    return '<i class="fas fa-bolt response-icon"></i>';
                case 'enjeux':
                    return '<i class="fas fa-feather-alt response-icon"></i>';
                case 'poisson':
                    return '<i class="fas fa-fish response-icon"></i>';
                case 'reflexive':
                    return '<i class="fas fa-brain response-icon"></i>';
                case 'theatre':
                    return '<i class="fas fa-theater-masks response-icon"></i>';
                case 'technique-longue':
                    return '<i class="fas fa-clipboard-list response-icon"></i>';
                case 'technique-courte':
                    return '<i class="fas fa-list response-icon"></i>';
                default:
                    return '<i class="fas fa-comment response-icon"></i>';
            }
        }
        
        // Fonction pour afficher les questions
        function displayQuestions(filteredQuestions) {
            questionList.innerHTML = '';
            
            if (filteredQuestions.length === 0) {
                questionList.innerHTML = '<p>Aucune question ne correspond aux crit√®res s√©lectionn√©s.</p>';
                return;
            }
            
            filteredQuestions.forEach(question => {
                const container = document.createElement('div');
                container.className = `question-container difficulty-${question.difficulty}`;
                
                const categoryNames = {
                    1: "Personnalit√©",
                    2: "Management",
                    3: "Culture territoriale",
                    4: "Mise en situation",
                    5: "Question embarrassante"
                };
                
                const categoryName = categoryNames[question.category] || "Autre";
                const subCategoryCode = `${question.category}.${question.subCategory}`;
                const subCategoryName = subCategoryNames[subCategoryCode] || "Autre";
                const difficultyDescription = difficultyDescriptions[question.difficulty] || "";
                
                const keywordsHTML = question.keywords.map(keyword => 
                    `<span class="keyword">${keyword}</span>`
                ).join('');
                
                // D√©terminer le type de r√©ponse bas√© sur la m√©thode de r√©ponse
                let responseType = "";
                let labels = ["", "", "", "", ""];
                let responseTitle = "";

                if (question.responseMethod) {
                    const methodLower = question.responseMethod.toLowerCase();
                    
                    if (methodLower.includes("rafale")) {
                        responseType = "rafale";
                        responseTitle = "R√©ponse rapide et concise";
                        labels = ["D√©finition/point cl√©", "Contextualisation", "Nuance/perspective", "", ""];
                    } 
                    else if (methodLower.includes("enjeux") || methodLower.includes("albatros")) {
                        responseType = "enjeux";
                        responseTitle = "R√©ponse par les enjeux (Albatros)";
                        labels = ["Enjeu 1 + point de vue", "Enjeu 2 + point de vue", "Enjeu 3 + point de vue", "", ""];
                    } 
                    else if (methodLower.includes("poisson") || methodLower.includes("japonais")) {
                        responseType = "poisson";
                        responseTitle = "Poisson japonais";
                        labels = ["Contextualisation (t√™te)", "Premi√®re ligne d'analyse (nageoire dorsale)", "Seconde ligne d'analyse (nageoire lat√©rale)", "R√©ponse pr√©cise (collet)", "Ouverture (queue)"];
                    }
                    else if (methodLower.includes("r√©flexive") || methodLower.includes("exemple structur√©")) {
                        responseType = "reflexive";
                        responseTitle = "Analyse r√©flexive";
                        labels = ["Analyse de la situation", "Comp√©tence d√©montr√©e", "Exemple concret", "Difficult√©s rencontr√©es", "Enseignements tir√©s"];
                    }
                    else if (methodLower.includes("pi√®ce de th√©√¢tre") || methodLower.includes("3 actes")) {
                        responseType = "theatre";
                        responseTitle = "Pi√®ce de th√©√¢tre en 3 actes";
                        labels = ["Acte I: Urgence", "Acte I: Mesures imm√©diates", "Acte II: Premi√®res mesures", "Acte II: Communications", "Acte III: Solutions √† moyen terme"];
                    }
                    else if (methodLower.includes("t√©l√©graphe") || methodLower.includes("technique longue") || methodLower.includes("r√©ponse technique longue")) {
                        responseType = "technique-longue";
                        responseTitle = "R√©ponse technique longue (5 phrases)";
                        labels = ["üìã Cadre juridique", "üìä Donn√©es factuelles", "‚öôÔ∏è Enjeux op√©rationnels", "üéØ Position argument√©e", "üîÆ Prospective"];
                    }
                    else if (methodLower.includes("technique courte") || methodLower.includes("r√©ponse technique courte")) {
                        responseType = "technique-courte";
                        responseTitle = "R√©ponse technique courte (2 phrases)";
                        labels = ["üí° Point cl√©", "üìä Donn√©e essentielle", "", "", ""];
                    }
                }

                // Ic√¥ne correspondant au type de r√©ponse
                const responseIcon = getResponseIcon(responseType);

                // Construire le HTML pour la r√©ponse automatique
                let autoResponseHTML = "";
                const hasPhrases = question.phrase1 || question.phrase2 || question.phrase3 || question.phrase4 || question.phrase5;

                if (hasPhrases) {
                    autoResponseHTML = `<div class="auto-response ${responseType}" style="display: none;">
                    <hr>
                    ${responseIcon}
                    <h4>${responseTitle}</h4>`;
                    
                    // Ajouter chaque phrase avec son label si elle existe
                    if (question.phrase1) autoResponseHTML += `<p><strong>${labels[0]}:</strong> ${question.phrase1}</p>`;
                    if (question.phrase2) autoResponseHTML += `<p><strong>${labels[1]}:</strong> ${question.phrase2}</p>`;
                    if (responseType === "technique-longue") {
                        // Pour la r√©ponse technique longue (5 phrases)
                        if (question.phrase3) autoResponseHTML += `<p><strong>${labels[2]}:</strong> ${question.phrase3}</p>`;
                        if (question.phrase4 && labels[3]) autoResponseHTML += `<p><strong>${labels[3]}:</strong> ${question.phrase4}</p>`;
                        if (question.phrase5 && labels[4]) autoResponseHTML += `<p><strong>${labels[4]}:</strong> ${question.phrase5}</p>`;
                    } else if (responseType !== "technique-courte") {
                        // Pour les autres m√©thodes (non techniques)
                        if (question.phrase3) autoResponseHTML += `<p><strong>${labels[2]}:</strong> ${question.phrase3}</p>`;
                        if (question.phrase4 && labels[3]) autoResponseHTML += `<p><strong>${labels[3]}:</strong> ${question.phrase4}</p>`;
                        if (question.phrase5 && labels[4]) autoResponseHTML += `<p><strong>${labels[4]}:</strong> ${question.phrase5}</p>`;
                    }
                    // Pour la r√©ponse technique courte (2 phrases), on s'arr√™te √† phrase2
                    
                    autoResponseHTML += '</div>';
                }
                
                container.innerHTML = `
                    <div class="question">${question.id}: ${question.question}</div>
                    <div class="metadata">
                        Cat√©gorie: ${categoryName}/${subCategoryName} | 
                        Type: ${question.type} | 
                        Difficult√©: Niveau ${question.difficulty} - ${difficultyDescription}
                        ${question.responseMethod ? ` | M√©thode: ${question.responseMethod}` : ''}
                    </div>
                    <div class="attention-points">Points d'attention: ${question.attention}</div>
                    <div class="keywords">${keywordsHTML}</div>
                    ${autoResponseHTML}
                `;
                
                questionList.appendChild(container);
            });
        }
        
        // Fonction pour afficher une question al√©atoire
        function showRandomQuestion() {
            let categoryValue = categoryFilter.value;
            let subcategoryValue = subcategoryFilter.value;
            let difficultyValue = difficultyFilter.value;
            let searchValue = searchInput.value.toLowerCase();
            
            let filteredQuestions = questions.filter(question => {
                let categoryMatch = categoryValue === 'all' || question.category.toString() === categoryValue;
                let subcategoryMatch = subcategoryValue === 'all' || 
                                     `${question.category}.${question.subCategory}` === subcategoryValue;
                let difficultyMatch = difficultyValue === 'all' || question.difficulty.toString() === difficultyValue;
                let searchMatch = searchValue === '' || 
                               question.question.toLowerCase().includes(searchValue) ||
                               question.keywords.some(k => k.toLowerCase().includes(searchValue));
                
                return categoryMatch && subcategoryMatch && difficultyMatch && searchMatch;
            });
            
            if (filteredQuestions.length > 0) {
                const randomIndex = Math.floor(Math.random() * filteredQuestions.length);
                displayQuestions([filteredQuestions[randomIndex]]);
                questionsCount.textContent = `Question al√©atoire (1 sur ${filteredQuestions.length})`;
            } else {
                questionList.innerHTML = '<p>Aucune question ne correspond aux crit√®res pour s√©lection al√©atoire.</p>';
                questionsCount.textContent = 'Aucune question disponible';
            }
        }
        
        // Fonction pour r√©initialiser les filtres
        function resetFilters() {
            categoryFilter.value = 'all';
            populateSubcategories('all');
            difficultyFilter.value = 'all';
            searchInput.value = '';
            filterQuestions();
        }
        
        // Fonction pour importer un fichier CSV
        function importCSV() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        processCSV(event.target.result);
                    };
                    reader.readAsText(file);
                }
                document.body.removeChild(fileInput);
            });
            
            fileInput.click();
        }
        
        // Fonction pour traiter le CSV
        function processCSV(csvContent) {
            Papa.parse(csvContent, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        const processedQuestions = processCSVData(results.data);
                        if (processedQuestions && processedQuestions.length > 0) {
                            questions = processedQuestions;
                            updateTabCounts();
                            try {
                                localStorage.setItem('examQuestions', JSON.stringify(questions));
                            } catch (e) {
                                console.warn("Impossible de sauvegarder dans localStorage:", e);
                            }
                            
                            populateSubcategories('all');
                            filterQuestions();
                            alert(`${questions.length} questions import√©es avec succ√®s !`);
                        } else {
                            alert("Aucune question valide n'a pu √™tre extraite du fichier.");
                        }
                    } else {
                        alert("Le fichier CSV semble vide ou mal format√©.");
                    }
                },
                error: function(error) {
                    console.error("Erreur d'analyse CSV:", error);
                    alert("Erreur lors de l'analyse du fichier CSV.");
                }
            });
        }
        
        // Fonction de traitement des donn√©es CSV (simplifi√©e)
        function processCSVData(csvData) {
            return csvData.map((item, index) => {
                if (!item.Question) return null;
                
                return {
                    id: `Q${index+1}`,
                    question: item.Question,
                    category: parseInt(item["Cat√©gorie principale"]) || 1,
                    subCategory: parseInt(item["Sous-cat√©gorie"]) || 1,
                    difficulty: parseInt(item["Niveau de difficult√©"]) || 2,
                    type: item["Type"] || "Opinion",
                    keywords: item["Mots-cl√©s"] ? item["Mots-cl√©s"].split(",").map(k => k.trim()) : [],
                    attention: item["Points d'attention (√©l√©ments clefs √† consid√©rer)"] || "Pr√©parez une r√©ponse structur√©e.",
                    responseMethod: item["M√©thode de r√©ponse recommand√©e"] || "",
                    phrase1: item["phrase 1"] || "",
                    phrase2: item["phrase 2"] || "",
                    phrase3: item["phrase 3"] || "",
                    phrase4: item["phrase 4"] || "",
                    phrase5: item["phrase 5"] || "",
                    epreuve: item["√âpreuve "] || item["√âpreuve"] || "ENTRETIEN"                 
                };
            }).filter(q => q !== null);
        }
        
        // Charger des exemples de questions
        function loadSampleQuestions() {
            questions = [
                {
                    id: "Q1",
                    question: "Comment d√©finiriez-vous le r√¥le du manager territorial ?",
                    category: 2,
                    subCategory: 1,
                    difficulty: 2,
                    type: "Opinion",
                    keywords: ["management", "service public", "leadership"],
                    attention: "Montre votre vision du management public. Int√©grer la dimension politique et la sp√©cificit√© du service public.",
                    responseMethod: "Par les enjeux",
                    epreuve: "ENTRETIEN",
                    phrase1: "Le management territorial conjugue efficacit√© gestionnaire et sens du service public",
                    phrase2: "Il s'agit d'animer des √©quipes dans un contexte d√©mocratique et citoyen",
                    phrase3: "L'enjeu est de moderniser l'action publique tout en pr√©servant ses valeurs"
                },
                {
                    id: "Q2",
                    question: "La diff√©renciation territoriale est-elle compatible avec l'√©galit√© r√©publicaine ?",
                    category: 3,
                    subCategory: 1,
                    difficulty: 3,
                    type: "Opinion",
                    keywords: ["diff√©renciation", "√©galit√©", "constitution", "adaptation"],
                    attention: "Question au c≈ìur des d√©bats actuels sur l'organisation territoriale. Montrer sa connaissance de la loi 3DS.",
                    responseMethod: "Poisson japonais",
                    epreuve: "ENTRETIEN",
                    phrase1: "La Constitution garantit l'√©galit√© devant la loi sur tout le territoire",
                    phrase2: "Les collectivit√©s peuvent adapter les politiques aux sp√©cificit√©s locales",
                    phrase3: "L'enjeu est de concilier unit√© nationale et diversit√© territoriale",
                    phrase4: "La loi 3DS ouvre des perspectives de diff√©renciation encadr√©e",
                    phrase5: "Cette √©volution questionne notre mod√®le r√©publicain traditionnel"
                },
                {
                    id: "Q3",
                    question: "Vous √™tes DGS et des ATSEM exercent leur droit de retrait. Que faites-vous ?",
                    category: 4,
                    subCategory: 3,
                    difficulty: 2,
                    type: "Mise en situation",
                    keywords: ["droit de retrait", "continuit√©", "s√©curit√©", "dialogue"],
                    attention: "Situation testant votre connaissance du droit de retrait et votre capacit√© √† concilier s√©curit√© et continuit√© du service public.",
                    responseMethod: "Pi√®ce de th√©√¢tre en 3 actes",
                    epreuve: "ENTRETIEN",
                    phrase1: "Je r√©unis imm√©diatement les ATSEM pour comprendre les motifs du retrait",
                    phrase2: "Je fais intervenir le CHSCT ou la commission de s√©curit√© comp√©tente",
                    phrase3: "J'organise des solutions temporaires pour assurer la continuit√© de service",
                    phrase4: "Je communique aupr√®s des parents et des enseignants sur la situation",
                    phrase5: "Je mets en place un plan d'am√©lioration des conditions de s√©curit√©"
                },
                {
                    id: "Q4",
                    question: "D√©finissez la notion de p√©r√©quation fiscale horizontale.",
                    category: 3,
                    subCategory: 2,
                    difficulty: 2,
                    type: "Factuelle",
                    keywords: ["p√©r√©quation", "fiscalit√©", "solidarit√© territoriale"],
                    attention: "Question technique n√©cessitant pr√©cision et exemples concrets.",
                    responseMethod: "R√©ponse technique courte",
                    epreuve: "DGCT",
                    phrase1: "M√©canisme de redistribution entre collectivit√©s de m√™me niveau",
                    phrase2: "Elle vise √† r√©duire les √©carts de richesse fiscale par habitant"
                },
                {
                    id: "Q5",
                    question: "Analysez les enjeux de la transition √©nerg√©tique pour les collectivit√©s territoriales.",
                    category: 3,
                    subCategory: 3,
                    difficulty: 3,
                    type: "Opinion",
                    keywords: ["transition √©nerg√©tique", "d√©veloppement durable", "politique publique"],
                    attention: "Question complexe n√©cessitant une analyse multidimensionnelle.",
                    responseMethod: "R√©ponse technique longue",
                    epreuve: "DGCT",
                    phrase1: "Les collectivit√©s sont acteurs cl√©s de la transition √©nerg√©tique territoriale",
                    phrase2: "Elles disposent de comp√©tences en am√©nagement, transport et habitat",
                    phrase3: "Les d√©fis financiers et techniques n√©cessitent des partenariats innovants",
                    phrase4: "L'acceptabilit√© sociale conditionne la r√©ussite des projets locaux",
                    phrase5: "Cette transition transforme le r√¥le des collectivit√©s en facilitatrices"
                }
            ];

            updateTabCounts();
            filterQuestions();
        }
        
        // Fonction pour afficher les informations sur une m√©thode
        function showMethodInfo(methodName) {
            const methodDescriptions = {
                'rafale': 'M√©thode de r√©ponse rapide et concise, efficace pour les questions factuelles.',
                'enjeux': 'Technique de l\'Albatros : r√©ponse structur√©e par identification des enjeux principaux.',
                'poisson': 'M√©thode du poisson japonais : contextualisation, analyse et ouverture.',
                'reflexive': 'Analyse r√©flexive bas√©e sur des exemples concrets et structur√©s.',
                'theatre': 'Mise en situation en 3 actes : urgence, mesures, solutions √† moyen terme.',
                'technique-longue': 'R√©ponse technique d√©velopp√©e en 5 phrases pour les √©preuves techniques.',
                'technique-courte': 'R√©ponse technique synth√©tique en 2 phrases pour les √©preuves techniques.'
            };
            
            alert(`${methodName.toUpperCase()}\n\n${methodDescriptions[methodName]}\n\n(Pages explicatives d√©taill√©es √† venir)`);
        }
        
        // Initialisation de l'application
        function init() {
            console.log("üîç Initialisation de l'application Admin'Quest");
            
            // Initialiser les √©l√©ments DOM
            categoryFilter = document.getElementById('categoryFilter');
            subcategoryFilter = document.getElementById('subcategoryFilter');
            difficultyFilter = document.getElementById('difficultyFilter');
            searchInput = document.getElementById('searchInput');
            randomButton = document.getElementById('randomButton');
            importButton = document.getElementById('importButton');
            resetButton = document.getElementById('resetButton');
            questionsCount = document.getElementById('questionsCount');
            questionList = document.getElementById('questionList');
            
            if (!categoryFilter || !subcategoryFilter || !questionList) {
                console.error("üîç √âl√©ments DOM manquants pour l'initialisation");
                return;
            }
            
            // Essayer de charger des questions du localStorage
            const savedQuestions = localStorage.getItem('examQuestions');
            if (savedQuestions) {
                try {
                    questions = JSON.parse(savedQuestions);
                    console.log("üîç Questions charg√©es depuis localStorage:", questions.length);
                    populateSubcategories('all');
                    updateTabCounts();
                    filterQuestions();
                } catch (e) {
                    console.error("üîç Erreur lors du chargement des questions:", e);
                    loadSampleQuestions();
                }
            } else {
                console.log("üîç Chargement des questions d'exemple");
                loadSampleQuestions();
            }
            
            // √âv√©nements
            categoryFilter.addEventListener('change', function() {
                populateSubcategories(this.value);
                filterQuestions();
            });
            
            subcategoryFilter.addEventListener('change', filterQuestions);
            difficultyFilter.addEventListener('change', filterQuestions);
            searchInput.addEventListener('input', filterQuestions);
            randomButton.addEventListener('click', showRandomQuestion);
            importButton.addEventListener('click', importCSV);
            resetButton.addEventListener('click', resetFilters);
            
            // √âcouteur d'√©v√©nement pour la case √† cocher des r√©ponses automatiques
            const showAutoResponsesCheckbox = document.getElementById('showAutoResponses');
            if (showAutoResponsesCheckbox) {
                showAutoResponsesCheckbox.addEventListener('change', function() {
                    const autoResponses = document.querySelectorAll('.auto-response');
                    autoResponses.forEach(response => {
                        response.style.display = this.checked ? 'block' : 'none';
                    });
             